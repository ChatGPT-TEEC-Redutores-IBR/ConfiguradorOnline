<!DOCTYPE html>

<main id="main-content" class="sr-only">
    <h1>
        Configurador
    </h1>

    <div id="titulo-estrutural">
        Configurador
    </div>
</main>

<link rel="stylesheet" href="/Layout/Galeria/Galeria.min.css">

<main class="main mb-0 pb-0">
    <div class="pagina__titulo--bloco fw-bold mt-5 mb-4">
    </div>
    <div class="container">
        <div class="galeria-produto" data-visible="4.K" data-folder="IBRK" data-title="IBR INVEOR M"
            data-description="É o modelo mais completo da linha, disponível nos tamanhos A, B, C e D, cobrindo uma ampla faixa de potências, com capacidade para motores de até 30 CV. Destaca-se pela variedade de versões com opções de comunicação em redes industriais, facilitando a integração em sistemas automatizados. Conta ainda com módulo opcional para controle de mótofreio e resistor de frenagem integrado, assegurando maior segurança e eficiência nas operações. Sua carcaça robusta em alumínio garante excelente resistência e dissipação térmica, enquanto o grau de proteção IP 65 permite instalação direta em ambientes industriais severos, sem necessidade de painéis adicionais. Combinando robustez, flexibilidade e facilidade de instalação, o INVEOR M é ideal para aplicações descentralizadas que exigem alto desempenho e confiabilidade."
            data-site="https://www.redutoresibr.com.br/pt/Produtos/inveor-m"
            data-catalog="https://www.redutoresibr.com.br/_uploads/b763bb9f-6d51-45ad-a202-b069174b5794.pdf">
        </div>
    </div>
    <div id="titulo-configurador" class="pagina__titulo--bloco mt-5 mb-5 text-center">
        <h2 id="texto-configurador" class="fs-3 fw-bolder m-0"></h2>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        function atualizarTitulo() {
            const visivel = Array.from(document.querySelectorAll('.galeria-produto[data-title]'))
                .find(g => g.style.display !== 'none');
            const titulo = visivel ? visivel.dataset.title : '';
            const el = document.getElementById('texto-configurador');
            if (!el) return;
            if (!titulo) {
                el.innerHTML = '';
                document.title = 'Configurador de Produtos';
                return;
            }
            let html = 'Configure o seu ';
            if (titulo.toUpperCase().startsWith('IBR ')) {
                const partes = titulo.split(' ');
                const primeiro = partes.shift();
                const resto = partes.join(' ');
                html += '<span class="text-dark">' + primeiro + '</span>';
                if (resto) html += ' <span class="text-orange">' + resto + '</span>';
            } else {
                html += titulo;
            }
            el.innerHTML = html;
            document.title = 'Configurador de Produtos - ' + titulo;
        }
        atualizarTitulo();
        setTimeout(atualizarTitulo);
        document.getElementById('INLN')?.addEventListener('change', atualizarTitulo);
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const helpConfigs = {

            GrupoINLN() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoINTP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoINTT() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoINPT() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoINFE() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoINPC() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoINAP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoINCM() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoINCP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoINCO() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoINOPCS() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOLN() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOCM() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },
        }

        const buttons = document.querySelectorAll('button.help-icon[data-help-text]');
        buttons.forEach(btn => {
            btn.dataset.helpTextOriginal = btn.dataset.helpText;
            btn.dataset.helpTitleOriginal = btn.dataset.helpTitle;
        });

        function updateButton(btn, data) {
            if (!data) {
                data = { title: btn.dataset.helpTitleOriginal, text: btn.dataset.helpTextOriginal };
            }
            btn.dataset.helpTitle = data.title || '';
            btn.dataset.helpText = data.text || '';
            btn.dataset.bsTitle = data.title || '';
            btn.dataset.bsContent = data.text || '';
            const pop = bootstrap.Popover.getOrCreateInstance(btn);
            pop.setContent({ '.popover-header': data.title || '', '.popover-body': data.text || '' });
        }

        function updateHelps() {
            buttons.forEach(btn => {
                const section = btn.closest('section');
                const cfgFn = section && helpConfigs[section.id];
                const data = cfgFn && cfgFn();
                updateButton(btn, data);
            });
        }

        ['INLN', 'INTP', 'INTT', 'INPT', 'INFE', 'INPC', 'INAP', 'INCM', 'INCP', 'INCO', 'INOPCS', 'MOLN', 'MOCM'].forEach(id => {
            document.getElementById(id)?.addEventListener('change', updateHelps);
        });

        updateHelps();
    });
</script>

<script src="/Layout/Galeria/Galeria.min.js"></script>
<script src="/Layout/Galeria/FiltrarPorURL.min.js"></script>

<section id="GrupoINLN">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="INLN">LINHA DO INVERSOR:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="INLN" name="INLN">

    </select>
</section>


<section id="GrupoINTP">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="INTP">TIPO DO INVERSOR:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="INTP" name="INTP">

    </select>
</section>


<section id="GrupoINTT">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="INTT">TENSÃO DO INVERSOR:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="INTT" name="INTT">

    </select>
</section>


<section id="GrupoINPT">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="INPT">POTÊNCIA DO INVERSOR:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="INPT" name="INPT">

    </select>
</section>


<section id="GrupoINFE">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="INFE">FRAME DO INVERSOR:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="INFE" name="INFE">

    </select>
</section>


<section id="GrupoINPC">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="INPC">PCI DE POTÊNCIA DO INVERSOR:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="INPC" name="INPC">

    </select>
</section>


<section id="GrupoINAP">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="INAP">PCI DE APLICAÇÃO DO INVERSOR:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="INAP" name="INAP">

    </select>
</section>


<section id="GrupoINCM">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="INCM">CARCAÇA DO INVERSOR:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="INCM" name="INCM">

    </select>
</section>


<section id="GrupoINCP">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="INCP">TAMPA DO INVERSOR:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="INCP" name="INCP">

    </select>
</section>


<section id="GrupoINCO">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="INCO">PADRÃO DO INVERSOR:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="INCO" name="INCO">

    </select>
</section>


<section id="GrupoINOPCS">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="INOPCS">SUPORTE DO INVERSOR:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="INOPCS" name="INOPCS">

    </select>


    <div class="subgrupo">
        <section id="GrupoMOLN">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOLN">LINHA DO MOTOR:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOLN" name="MOLN">

            </select>
        </section>

        <section id="GrupoMOCM">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOCM">CARCAÇA DO MOTOR:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOCM" name="MOCM">

            </select>
        </section>
    </div>
</section>

</div>
</section>

<script>

    async function carregarINLN() {
        const grupo = document.getElementById('GrupoINLN');
        const select = document.getElementById('INLN');
        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/INLN.php`);
        select.innerHTML = await response.text();
        grupo.style.display = select.style.display = 'block';

        carregarINTP();
    }

    async function carregarINTP() {
        const inln = v("INLN");
        const grupo = document.getElementById('GrupoINTP');
        const select = document.getElementById('INTP');
        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/INTP.php?INLN=${encodeURIComponent(inln)}`);
        select.innerHTML = await response.text();
        grupo.style.display = select.style.display = 'block';

        carregarINTT();
    }

    async function carregarINTT() {
        const inln = v("INLN");
        const intp = v("INTP");
        const grupo = document.getElementById('GrupoINTT');
        const select = document.getElementById('INTT');
        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/INTT.php?INLN=${encodeURIComponent(inln)}&INTP=${encodeURIComponent(intp)}`);
        select.innerHTML = await response.text();
        grupo.style.display = select.style.display = 'block';
        select.value = '';

        carregarINPT();
    }

    async function carregarINPT() {
        const inln = v("INLN");
        const intp = v("INTP");
        const intt = v("INTT");
        const grupo = document.getElementById('GrupoINPT');
        const select = document.getElementById('INPT');
        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/INPT.php?INLN=${encodeURIComponent(inln)}&INTP=${encodeURIComponent(intp)}&INTT=${encodeURIComponent(intt)}`);
        select.innerHTML = await response.text();
        grupo.style.display = select.style.display = 'block';
        select.value = '';

        carregarINFE();
    }

    async function carregarINFE() {
        const inln = v("INLN");
        const intp = v("INTP");
        const intt = v("INTT");
        const inpt = v("INPT");
        const grupo = document.getElementById('GrupoINFE');
        const select = document.getElementById('INFE');
        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/INFE.php?INLN=${encodeURIComponent(inln)}&INTP=${encodeURIComponent(intp)}&INTT=${encodeURIComponent(intt)}&INPT=${encodeURIComponent(inpt)}`);
        select.innerHTML = await response.text();
        grupo.style.display = select.style.display = 'block';
        select.value = '';

        carregarINPC();
    }

    async function carregarINPC() {
        const inln = v("INLN");
        const intp = v("INTP");
        const intt = v("INTT");
        const inpt = v("INPT");
        const infe = v("INFE");
        const grupo = document.getElementById('GrupoINPC');
        const select = document.getElementById('INPC');
        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/INPC.php?INLN=${encodeURIComponent(inln)}&INTP=${encodeURIComponent(intp)}&INTT=${encodeURIComponent(intt)}&INPT=${encodeURIComponent(inpt)}&INFE=${encodeURIComponent(infe)}`);
        select.innerHTML = await response.text();
        grupo.style.display = select.style.display = 'block';
        select.value = '';

        carregarINAP();
    }

    async function carregarINAP() {
        const inln = v("INLN");
        const intp = v("INTP");
        const intt = v("INTT");
        const inpt = v("INPT");
        const infe = v("INFE");
        const inpc = v("INPC");
        const grupo = document.getElementById('GrupoINAP');
        const select = document.getElementById('INAP');
        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/INAP.php?INLN=${encodeURIComponent(inln)}&INTP=${encodeURIComponent(intp)}&INTT=${encodeURIComponent(intt)}&INPT=${encodeURIComponent(inpt)}&INFE=${encodeURIComponent(infe)}&INPC=${encodeURIComponent(inpc)}`);
        select.innerHTML = await response.text();
        grupo.style.display = select.style.display = 'block';
        select.value = '';

        carregarINCM();
    }

    async function carregarINCM() {
        const inln = v("INLN");
        const intp = v("INTP");
        const intt = v("INTT");
        const inpt = v("INPT");
        const infe = v("INFE");
        const inpc = v("INPC");
        const inap = v("INAP");
        const grupo = document.getElementById('GrupoINCM');
        const select = document.getElementById('INCM');
        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/INCM.php?INLN=${encodeURIComponent(inln)}&INTP=${encodeURIComponent(intp)}&INTT=${encodeURIComponent(intt)}&INPT=${encodeURIComponent(inpt)}&INFE=${encodeURIComponent(infe)}&INPC=${encodeURIComponent(inpc)}&INAP=${encodeURIComponent(inap)}`);
        select.innerHTML = await response.text();
        grupo.style.display = select.style.display = 'block';
        select.value = '';

        carregarINCP();
    }

    async function carregarINCP() {
        const inln = v("INLN");
        const intp = v("INTP");
        const intt = v("INTT");
        const inpt = v("INPT");
        const infe = v("INFE");
        const inpc = v("INPC");
        const inap = v("INAP");
        const incm = v("INCM");
        const grupo = document.getElementById('GrupoINCP');
        const select = document.getElementById('INCP');
        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/INCP.php?INLN=${encodeURIComponent(inln)}&INTP=${encodeURIComponent(intp)}&INTT=${encodeURIComponent(intt)}&INPT=${encodeURIComponent(inpt)}&INFE=${encodeURIComponent(infe)}&INPC=${encodeURIComponent(inpc)}&INAP=${encodeURIComponent(inap)}&INCM=${encodeURIComponent(incm)}`);
        select.innerHTML = await response.text();
        grupo.style.display = select.style.display = 'block';
        select.value = '';

        carregarINCO();
    }

    async function carregarINCO() {
        const inln = v("INLN");
        const intp = v("INTP");
        const intt = v("INTT");
        const inpt = v("INPT");
        const infe = v("INFE");
        const inpc = v("INPC");
        const inap = v("INAP");
        const incm = v("INCM");
        const incp = v("INCP");
        const grupo = document.getElementById('GrupoINCO');
        const select = document.getElementById('INCO');
        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/INCO.php?INLN=${encodeURIComponent(inln)}&INTP=${encodeURIComponent(intp)}&INTT=${encodeURIComponent(intt)}&INPT=${encodeURIComponent(inpt)}&INFE=${encodeURIComponent(infe)}&INPC=${encodeURIComponent(inpc)}&INAP=${encodeURIComponent(inap)}&INCM=${encodeURIComponent(incm)}&INCP=${encodeURIComponent(incp)}`);
        select.innerHTML = await response.text();
        grupo.style.display = select.style.display = 'block';

        select.dispatchEvent(new Event('change'));
        carregarINOPCS();
    }

    async function carregarINOPCS() {
        const inln = v("INLN");
        const intp = v("INTP");
        const intt = v("INTT");
        const infe = v("INFE");
        const inco = v("INCO");

        const grupo = document.getElementById('GrupoINOPCS');
        const select = document.getElementById('INOPCS');
        const subgrupo = grupo.querySelector('.subgrupo');

        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/INOPCS.php?INLN=${encodeURIComponent(inln)}&INTP=${encodeURIComponent(intp)}&INTT=${encodeURIComponent(intt)}&INFE=${encodeURIComponent(infe)}&INCO=${encodeURIComponent(inco)}`);
        select.innerHTML = await response.text();

        grupo.style.display = 'block';
        select.style.display = 'block';

        const atualizarSubgrupo = () => {
            const mostrar = select.value.trim() === 'NM';
            subgrupo.style.display = mostrar ? 'block' : 'none';
            if (mostrar) {
                carregarMOLN();
            }
        };

        select.addEventListener('change', atualizarSubgrupo);
        atualizarSubgrupo();
    }

    async function carregarMOLN() {
        const inln = v("INLN");
        const intp = v("INTP");
        const intt = v("INTT");
        const infe = v("INFE");
        const inco = v("INCO");
        const inopcs = v("INOPCS");

        const grupo = document.getElementById("GrupoMOLN");
        const select = document.getElementById("MOLN");

        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/MOLN.php?INLN=${encodeURIComponent(inln)}&INTP=${encodeURIComponent(intp)}&INTT=${encodeURIComponent(intt)}&INFE=${encodeURIComponent(infe)}&INCO=${encodeURIComponent(inco)}&INOPCS=${encodeURIComponent(inopcs)}`);

        select.innerHTML = await response.text();

        grupo.style.display = 'block';
        select.style.display = 'block';

        select.value = '';
        select.dispatchEvent(new Event('change'));

        carregarMOCM();
    }

    async function carregarMOCM() {
        const inln = v("INLN");
        const intp = v("INTP");
        const intt = v("INTT");
        const infe = v("INFE");
        const inco = v("INCO");
        const inopcs = v("INOPCS");
        const moln = v("MOLN");

        const grupo = document.getElementById("GrupoMOCM");
        const select = document.getElementById("MOCM");

        const response = await fetch(`/Paginas/Seletores/Configuradores/IN/MOCM.php?INLN=${encodeURIComponent(inln)}&INTP=${encodeURIComponent(intp)}&INTT=${encodeURIComponent(intt)}&INFE=${encodeURIComponent(infe)}&INCO=${encodeURIComponent(inco)}&INOPCS=${encodeURIComponent(inopcs)}&MOLN=${encodeURIComponent(moln)}`);

        select.innerHTML = await response.text();

        select.value = '';

        grupo.style.display = 'block';
        select.style.display = 'block';
    }


    document.addEventListener("DOMContentLoaded", () => {
        carregarINLN();

        document.getElementById('INLN')?.addEventListener('change', carregarINTP);
        document.getElementById('INTP')?.addEventListener('change', carregarINTT);
        document.getElementById('INTT')?.addEventListener('change', carregarINPT);
        document.getElementById('INPT')?.addEventListener('change', carregarINFE);
        document.getElementById('INFE')?.addEventListener('change', carregarINPC);
        document.getElementById('INPC')?.addEventListener('change', carregarINAP);
        document.getElementById('INAP')?.addEventListener('change', carregarINCM);
        document.getElementById('INCM')?.addEventListener('change', carregarINCP);
        document.getElementById('INCP')?.addEventListener('change', carregarINCO);
        document.getElementById('INCO')?.addEventListener('change', carregarINOPCS);
        document.getElementById('INOPCS')?.addEventListener('change', carregarMOLN);
        document.getElementById('INOPCS')?.addEventListener('change', carregarMOCM);
        document.getElementById('MOLN')?.addEventListener('change', carregarMOCM);
    })

</script>

<script>
    function exibirBotaoCompartilhar() {
        const wrapper = document.getElementById("compartilhar-wrapper");
        if (wrapper) wrapper.style.display = "block";
    }

    function exibirBotaoSolicitarCotacao() {
        const wrapper = document.getElementById("cotacao-wrapper");
        if (wrapper) wrapper.style.display = "block";
    }

    async function gerarCodigoProduto() {
        const INLN = v("INLN");
        const INTP = v("INTP");
        const INTT = v("INTT");
        const INPT = v("INPT");
        const INFE = v("INFE");
        const INPC = v("INPC");
        const INAP = v("INAP");
        const INCM = v("INCM");
        const INCP = v("INCP");
        const INCO = v("INCO");
        const INOPCS = v("INOPCS");
        const MOLN = v("MOLN");
        const MOCM = v("MOCM");

        const SUPORTE = INOPCS === "NP" ? "" : `.${MOLN}.${MOCM}`;

        const COMPOSICAOCODIGO = [
            INLN,
            INTP,
            INTT,
            INPT,
            INFE,
            INPC,
            INAP,
            INCM,
            INCP,
            INCO,
            INOPCS + SUPORTE
        ]
            .map(s => s.replace(/^\.|\.$/g, ""))
            .map(s => s.replace(/,\s*/g, ".").replace(/\s+/g, ""))
            .map(s => s.replace(/\.{2,}/g, "."))
            .filter(Boolean)
            .join(".");

        document.getElementById("refProduto").textContent = COMPOSICAOCODIGO;
        mostrarDetalhesProduto({}, COMPOSICAOCODIGO);

        fetch("/Paginas/Seletores/Produto/CodigoDescricaoObservacaoProduto.php", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `codigo=${encodeURIComponent(COMPOSICAOCODIGO)}`
        })
            .then(resp => resp.text())
            .then(text => {
                let dados;
                try { dados = JSON.parse(text); } catch { throw new Error(text); }
                return dados;
            })
            .then(dados => {
                mostrarDetalhesProduto(dados || {}, COMPOSICAOCODIGO);
                if (typeof mostrarDetalhesEstoque === 'function') {
                    mostrarDetalhesEstoque(dados?.CD_PRODUTO || "");
                }
            })
            .catch(err => {
                console.error('Erro ao obter dados do produto', err);
                if (typeof exibirAlerta === 'function') {
                    exibirAlerta('⚠️ Erro ao obter dados do produto.');
                }
                mostrarDetalhesProduto({}, COMPOSICAOCODIGO);
                if (typeof mostrarDetalhesEstoque === 'function') {
                    mostrarDetalhesEstoque('');
                }
            });


        if (window.ultimoHistoricoProduto !== COMPOSICAOCODIGO) {
            fetch("/Paginas/AreaCliente/Sessao/Produtos/RegistrarProduto.php", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `produto=${encodeURIComponent(COMPOSICAOCODIGO)}`
            });
            window.ultimoHistoricoProduto = COMPOSICAOCODIGO;
        }

        exibirBotaoCompartilhar();
        exibirBotaoSolicitarCotacao();
    }
</script>

<script>
    document.addEventListener('click', e => {
        const img = e.target.closest('.popover img');
        if (!img) return;
        e.preventDefault();
        const container = img.closest('.popover-body');
        if (!container) return;
        const imgs = Array.from(container.querySelectorAll('img')).filter(i => i.naturalWidth);
        const index = imgs.indexOf(img);
        const items = imgs.map(i => ({
            src: i.src,
            width: i.naturalWidth || 800,
            height: i.naturalHeight || 600
        }));
        const lb = new PhotoSwipeLightbox({
            dataSource: items,
            pswpModule: PhotoSwipe,
            initialZoomLevel: 1,
            secondaryZoomLevel: 2,
            wheelToZoom: true,
            imageClickAction: 'zoom'
        });
        lb.on('close', () => lb.destroy());
        lb.init();
        lb.loadAndOpen(index);
    });
</script>

</body>

</html>