<!DOCTYPE html>

<main id="main-content" class="sr-only">
    <h1>
        Configurador
    </h1>

    <div id="titulo-estrutural">
        Configurador
    </div>
</main>

<link rel="stylesheet" href="/Layout/Galeria/Galeria.min.css">

<main class="main mb-0 pb-0">
    <div class="pagina__titulo--bloco fw-bold mt-5 mb-4">
    </div>
    <div class="container">
        <div class="galeria-produto" data-visible="1.QDR" data-folder="IBRQDR" data-title="IBR QDR"
            data-description="Fabricada com a união de dois redutores com engrenagens do tipo coroa e rosca sem fim, a linha de redutores e motorredutores IBR QDR possui uma grande variedade de reduções e é ideal para aplicações que necessitam grandes reduções. O formato quadrado de seu corpo e os acessórios de fixação, como flanges de saída e braços de torque, proporcionam diversas opções de montagem nas máquinas e equipamentos. Eles podem ainda ser fornecidos com eixos de saída maciços ou vazados."
            data-site="https://www.redutoresibr.com.br/pt/Produtos/ibr-qdr"
            data-catalog="https://www.redutoresibr.com.br/_uploads/9829c20a-28d7-47fc-a772-063aa65fd1da.pdf">
        </div>

        <div class="galeria-produto" data-visible="1.QP" data-folder="IBRQP" data-title="IBR QP"
            data-description="Fabricado com a união de dois redutores, sendo um com engrenagens do tipo coroa e rosca sem fim e outro com engrenagens cilíndricas helicoidais, a linha de redutores e motorredutores IBR QP se destaca por unir excelente custo benefício, alto desempenho e modularidade, além de um bom rendimento. O formato quadrado de seu corpo e os acessórios de fixação, como flanges de saída e braços de torque, proporcionam diversas opções de montagem nas máquinas e equipamentos. Eles podem ainda ser fornecidos com eixos de saída maciços ou vazados."
            data-site="https://www.redutoresibr.com.br/pt/Produtos/ibr-qp"
            data-catalog="https://www.redutoresibr.com.br/_uploads/ec33429f-b17a-4433-b2aa-f27f5f7ed5b0.pdf">
        </div>
    </div>
    <div id="titulo-configurador" class="pagina__titulo--bloco mt-5 mb-5 text-center">
        <h2 id="texto-configurador" class="fs-3 fw-bolder m-0"></h2>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const helpConfigs = {

            GrupoQULN() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUBR() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUEX() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUVZ() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQURD() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQURD1() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQURD2() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUCM() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUBU() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUCM2() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUBU2() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUUN() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUCP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUAF() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUAFP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUBT() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUAS() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUASP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUCL() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUCLP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUPOC() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUPOL() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUOPC() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUMO() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOLN() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOTP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOTT() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOFQ() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOPT() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOPL() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOCP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOCPP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOPC() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOPP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOOPC() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOCR() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUCR() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUVA() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoVALN() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoVAPT() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoVAECP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoVASCP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoVAPM() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoQUPL() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoPLDE() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoPLBU() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoPLGU() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoPLFU() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },
        }

        const buttons = document.querySelectorAll('button.help-icon[data-help-text]');
        buttons.forEach(btn => {
            btn.dataset.helpTextOriginal = btn.dataset.helpText;
            btn.dataset.helpTitleOriginal = btn.dataset.helpTitle;
        });

        function updateButton(btn, data) {
            if (!data) {
                data = { title: btn.dataset.helpTitleOriginal, text: btn.dataset.helpTextOriginal };
            }
            btn.dataset.helpTitle = data.title || '';
            btn.dataset.helpText = data.text || '';
            btn.dataset.bsTitle = data.title || '';
            btn.dataset.bsContent = data.text || '';
            const pop = bootstrap.Popover.getOrCreateInstance(btn);
            pop.setContent({ '.popover-header': data.title || '', '.popover-body': data.text || '' });
        }

        function updateHelps() {
            buttons.forEach(btn => {
                const section = btn.closest('section');
                const cfgFn = section && helpConfigs[section.id];
                const data = cfgFn && cfgFn();
                updateButton(btn, data);
            });
        }

        ['QULN', 'QUBR', 'QUEX', 'QUVZ', 'QURD', 'QUDR1', 'QUDR2', 'QUCM', 'QUBU', 'QUCM2', 'QUBU2', 'QUUN', 'QUCP', 'QUAF', 'QUAFP', 'QUBT', 'QUAS', 'QUASP', 'QUCL', 'QUCLP', 'QUPOC', 'QUPOL', 'QUOPC', 'QUMO',
            'MOLN', 'MOTP', 'MOTT', 'MOFQ', 'MOPT', 'MOPL', 'MOCP', 'MOCPP', 'MOPC', 'MOPP', 'MOOPC', 'MOCR', 'QUCR', 'QUVA', 'VALN', 'VAPT', 'VAECP', 'VASCP', 'VAPM', 'QUPL', 'PLDE', 'PLBU', 'PLGU', 'PLFU'].forEach(id => {
                document.getElementById(id)?.addEventListener('change', updateHelps);
            });

        updateHelps();
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        function atualizarTitulo() {
            const visivel = Array.from(document.querySelectorAll('.galeria-produto[data-title]'))
                .find(g => g.style.display !== 'none');
            const titulo = visivel ? visivel.dataset.title : '';
            const el = document.getElementById('texto-configurador');
            if (!el) return;
            if (!titulo) {
                el.innerHTML = '';
                document.title = 'Configurador de Produtos';
                return;
            }
            let html = 'Configure o seu ';
            if (titulo.toUpperCase().startsWith('IBR ')) {
                const partes = titulo.split(' ');
                const primeiro = partes.shift();
                const resto = partes.join(' ');
                html += '<span class="text-dark">' + primeiro + '</span>';
                if (resto) html += ' <span class="text-orange">' + resto + '</span>';
            } else {
                html += titulo;
            }
            el.innerHTML = html;
            document.title = 'Configurador de Produtos - ' + titulo;
        }
        atualizarTitulo();
        setTimeout(atualizarTitulo);
        document.getElementById('QULN')?.addEventListener('change', atualizarTitulo);
    });
</script>

<script src="/Layout/Galeria/Galeria.min.js"></script>
<script src="/Layout/Galeria/FiltrarPorURL.min.js"></script>

<section id="GrupoQULN">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QULN">Linha do Redutor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QULN" name="QULN">
    </select>
</section>

<section id="GrupoQUBR">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUBR">Tamanho do Redutor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QUBR" name="QUBR">
    </select>


    <div class="subgrupo">

        <section id="GrupoQUEX">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUEX">Com Eixo
                Estendido:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="QUEX" name="QUEX">
                <option value="N" selected>NÃO</option>
                <option value="S">SIM</option>
            </select>
        </section>


        <section id="GrupoQUVZ" style="display: none;">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUVZ">Vazado do Redutor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="QUVZ" name="QUVZ">
            </select>
        </section>
    </div>
</section>


<section id="GrupoQURD">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QURD">Redução Total do Redutor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QURD" name="QURD">
    </select>


    <div class="subgrupo">

        <section id="GrupoQURD1">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QURD1">Redução do 1º Estágio
                do Redutor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="QURD1" name="QURD1">
            </select>
        </section>


        <section id="GrupoQURD2">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QURD2">Redução do 2º Estágio
                do Redutor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="QURD2" name="QURD2">
            </select>
        </section>
    </div>
</section>



<section id="GrupoQUCM">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUCM">Tamanho da Carcaça ou Eixo de
        Entrada do Redutor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QUCM" name="QUCM">
    </select>


    <div class="subgrupo">

        <section id="GrupoQUBU" style="display: none;">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUBU">Bucha de Redução do
                Redutor:<button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="QUBU" name="QUBU" disabled>
            </select>
        </section>

        <section id="GrupoQUCM2" style="display: none;">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUCM2">Tamanho da Carcaça do
                2º Estágio do Redutor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="QUCM2" name="QUCM2" disabled>
            </select>
        </section>

        <section id="GrupoQUBU2" style="display: none;">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUBU2">Bucha de Redução do
                2º Estágio do Redutor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="QUBU2" name="QUBU2" disabled>
            </select>
        </section>

    </div>
</section>


<section id="GrupoQUUN">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUUN">União das Carcaças do Redutor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QUUN" name="QUUN"></select>
</section>


<section id="GrupoQUCP">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUCP">Forma Construtiva ou Eixo de
        Entrada do Redutor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QUCP" name="QUCP">
    </select>
</section>


<section id="GrupoQUAF" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUAF">Acessório de Fixação do
        Redutor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QUAF" name="QUAF">
    </select>


    <div class="subgrupo" style="display: none;">

        <section id="GrupoQUAFP" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUAFP">Posição do Acessório
                de Fixação:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="QUAFP" name="QUAFP">
                <option value="A" selected>DIREITA</option>
                <option value="B">ESQUERDA</option>
            </select>
        </section>


        <section id="GrupoQUBT" class="grupo-condicional" style="display: none;">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUBT">Posição do Braço de
                Torque:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="QUBT" name="QUBT">
                <option value="1" selected>1</option>
                <option id="optQUBT2" value="2" style="display: none;">2</option>
                <option value="3">3</option>
                <option id="optQUBT4" value="4" style="display: none;">4</option>
                <option value="5">5</option>
            </select>
        </section>
    </div>
</section>


<section id="GrupoQUAS" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUAS">Acessório de Saída do Redutor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QUAS" name="QUAS">
    </select>


    <div class="subgrupo" style="display: none;">

        <section id="GrupoQUASP" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUASP">Posição do Acessório
                de Saída:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="QUASP" name="QUASP">
                <option value="A" selected>DIREITA</option>
                <option value="B">ESQUERDA</option>
            </select>
        </section>
    </div>
</section>


<section id="GrupoQUCL" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUCL">Com Capa de Proteção Lateral
        do Redutor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QUCL" name="QUCL">
        <option value="N">NÃO</option>
        <option value="CP">SIM</option>
    </select>


    <div class="subgrupo" style="display: none;">

        <section id="GrupoQUCLP" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUCLP">Posição da Capa
                Lateral do Redutor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="QUCLP" name="QUCLP">
            </select>
        </section>
    </div>
</section>


<section id="GrupoQUPOC" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUPOC">Coordenada do Redutor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QUPOC" name="QUPOC">
        <option value="Z">Z</option>
        <option value="Y">Y</option>
    </select>


    <div class="subgrupo" style="display: none;">

        <section id="GrupoQUPOL" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUPOL">Localização do
                Redutor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="QUPOL" name="QUPOL">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        </section>
    </div>
</section>


<section id="GrupoQUOPC">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUOPC_NAO">Itens Opcionais do
        Redutor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <div id="dropdownQUOPC" class="dropdown-checkbox" style="max-width:400px; margin: 0 auto;">
        <div class="dropdown-button cssC" onclick="toggleDropdown(this)">NÃO</div>
        <div class="dropdown-list"
            style="display:none; border: 1px solid #ec4115; max-height: 180px; overflow-y: auto; border-radius: 6px; background: white; padding: 10px; margin-top: 4px;">
            <div id="checklistQUOPC" style="display:flex; flex-direction:column; gap:6px; text-align:left;">
                <label><input type="checkbox" id="QUOPC_NAO" name="QUOPC" value="NÃO" checked> NÃO</label>
                <label><input type="checkbox" name="QUOPC" value="ACOR"> PINTURA ANTICORROSIVA</label>
                <label><input type="checkbox" name="QUOPC" value="PINTCZ"> PINTURA CINZA</label>
                <label><input type="checkbox" name="QUOPC" value="RESP"> RESPIRO</label>
                <label><input type="checkbox" name="QUOPC" value="RT"> RETENTOR</label>
            </div>
        </div>
        <input type="hidden" id="QUOPC" name="QUOPC" value="NÃO">
    </div>
</section>


<section id="GrupoQUMO" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUMO">Com Motor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QUMO" name="QUMO">
        <option value="N">NÃO</option>
        <option value="S">SIM</option>
    </select>


    <div class="subgrupo" style="display: none;">

        <section id="GrupoMOLN" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOLN">Linha do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOLN" name="MOLN">

            </select>
        </section>


        <section id="GrupoMOTP" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOTP">Tipo do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOTP" name="MOTP">

            </select>
        </section>


        <section id="GrupoMOTT" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOTT">Tensão do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOTT" name="MOTT">

            </select>
        </section>


        <section id="GrupoMOFQ" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOFQ">Frequência do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOFQ" name="MOFQ">

            </select>
        </section>


        <section id="GrupoMOPT" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOPT">Potência do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOPT" name="MOPT">

            </select>
        </section>


        <section id="GrupoMOPL" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOPL">Polaridade do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOPL" name="MOPL">

            </select>
        </section>


        <section id="GrupoMOCP" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOCP">Forma Construtiva do
                Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOCP" name="MOCP">

            </select>


            <div class="SubgrupoMOCP" style="display: none;">
                <section id="GrupoMOCPP" class="subgrupo subgrupo-aninhado grupo-condicional">
                    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOCPP">Posição dos
                        Pés do Motor:
                        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                            data-bs-title="" data-bs-content=""></button>
                    </label>
                    <select class="cssC" id="MOCPP" name="MOCPP">

                    </select>
                </section>
            </div>
        </section>


        <section id="GrupoMOPC" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOPC">Posição da Caixa de
                Ligação ou de Montagem do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOPC" name="MOPC">

            </select>
        </section>


        <section id="GrupoMOPP" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOPP">Posição do Prensa
                Cabo:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOPP" name="MOPP">

            </select>
        </section>


        <section id="GrupoMOOPC" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOOPC_NAO">Itens Opcionais
                do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <div id="dropdownMOOPC" class="dropdown-checkbox" style="max-width:400px; margin: 0 auto;">
                <div class="dropdown-button cssC" onclick="toggleDropdown(this)">NÃO</div>
                <div class="dropdown-list"
                    style="display:none; border: 1px solid #ec4115; max-height: 180px; overflow-y: auto; border-radius: 6px; background: white; padding: 10px; margin-top: 4px;">
                    <div id="checklistMOOPC" style="display:flex; flex-direction:column; gap:6px; text-align:left;">
                        <label><input type="checkbox" id="MOOPC_NAO" name="MOOPC" value="NÃO" checked> NÃO</label>
                        <label><input type="checkbox" name="MOOPC" value="ACOR"> PINTURA ANTICORROSIVA</label>
                        <label><input type="checkbox" name="MOOPC" value="PINTCZ"> PINTURA CINZA</label>
                        <label><input type="checkbox" name="MOOPC" value="VF"> VENTILAÇÃO FORÇADA</label>
                        <label><input type="checkbox" name="MOOPC" value="CR"> CONTRA RECUO</label>
                    </div>
                </div>
                <input type="hidden" id="MOOPC" name="MOOPC" value="NÃO">
            </div>


            <div class="SubgrupoMOOPC" style="display: none;">
                <section id="GrupoMOCR" class="subgrupo subgrupo-aninhado grupo-condicional">
                    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOCR">Sentido de
                        Giro do Motor:
                        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                            data-bs-title="" data-bs-content=""></button>
                    </label>
                    <select class="cssC" id="MOCR" name="MOCR">
                        <option value="H">HORÁRIO</option>
                        <option value="AH">ANTI-HORÁRIO</option>
                    </select>
                </section>


                <section id="GrupoQUCR" class="subgrupo subgrupo-aninhado grupo-condicional">
                    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUCR">Sentido de
                        Giro do Redutor:
                        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                            data-bs-title="" data-bs-content=""></button>
                    </label>
                    <select class="cssC" id="QUCR" name="QUCR">

                    </select>
                </section>
            </div>
        </section>
    </div>
</section>


<section id="GrupoQUVA" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUVA">Com Variador (Apenas B5):
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QUVA" name="QUVA">
        <option value="N">NÃO</option>
        <option value="S">SIM</option>
    </select>


    <div class="subgrupo" style="display: none;">

        <section id="GrupoVALN" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VALN">Linha do Variador:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="VALN" name="VALN">

            </select>
        </section>


        <section id="GrupoVAPT" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VAPT">Potência do Variador:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="VAPT" name="VAPT">

            </select>
        </section>


        <section id="GrupoVAECP" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VAECP">Forma Construtiva da
                Entrada do Variador:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="VAECP" name="VAECP">
                <option value="B5">B5</option>
            </select>


            <div class="subgrupo subgrupo-aninhado">
                <section id="GrupoVASCP" class="grupo-condicional">
                    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VASCP">Forma
                        Construtiva da Saída do Variador:
                        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                            data-bs-title="" data-bs-content=""></button>
                    </label>
                    <select class="cssC" id="VASCP" name="VASCP">

                    </select>
                </section>
            </div>
        </section>


        <section id="GrupoVAPM" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VAPM">Posição de Montagem do
                Variador:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="VAPM" name="VAPM">
                <option value="B3">B3</option>
                <option value="B5">B5</option>
                <option value="V6">V6</option>
            </select>
        </section>
    </div>
</section>


<section id="GrupoQUPL" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="QUPL">Adaptação para Servomotor
        (B14):
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="QUPL" name="QUPL">
        <option value="N">NÃO</option>
        <option value="S">SIM</option>
    </select>


    <div class="subgrupo" style="display: none;">

        <section id="GrupoPLDE" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="PLDE">Diâmetro do Eixo do
                Servomotor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="PLDE" name="PLDE"></select>


            <div class="subgrupo subgrupo-aninhado">
                <section id="GrupoPLBU" class="grupo-condicional">
                    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="PLBU">Bucha de
                        Redução da Adaptação:
                        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                            data-bs-title="" data-bs-content=""></button>
                    </label>
                    <select class="cssC" id="PLBU" name="PLBU"></select>
                </section>
            </div>
        </section>


        <section id="GrupoPLGU" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="PLGU">Guia da Flange da
                Adaptação:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="PLGU" name="PLGU"></select>
        </section>


        <section id="GrupoPLFU" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="PLFU">Furação do Guia da
                Flange da Adaptação:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="PLFU" name="PLFU"></select>
        </section>
</section>

</div>
</section>

<script>

    async function carregarQULN() {
        const qulnSelect = document.getElementById('QULN');

        const response = await fetch('/Paginas/Seletores/Configuradores/QUDR/QULN.php');
        const optionsHTML = await response.text();

        qulnSelect.innerHTML = optionsHTML;

        qulnSelect.value = '';
        qulnSelect.disabled = false;

        qulnSelect.dispatchEvent(new Event('change'));
    }

    document.addEventListener('DOMContentLoaded', () => {
        carregarQULN();

        document.getElementById('QULN')?.addEventListener('change', () => {
            carregarQUPOC();
        });
    });



    async function carregarQUBR() {
        const qulnSelect = document.getElementById('QULN');
        const qubrSelect = document.getElementById('QUBR');
        const grupoQUBR = document.getElementById('GrupoQUBR');

        const quln = qulnSelect.value;

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/QUBR.php?QULN=${encodeURIComponent(quln)}`);
        const optionsHTML = await response.text();

        qubrSelect.innerHTML = optionsHTML;
        grupoQUBR.style.display = 'block';
        qubrSelect.disabled = false;
        qubrSelect.value = '';

        qubrSelect.addEventListener('change', () => {
            carregarQUVZ();
        });

        qubrSelect.addEventListener('change', () => {
            const subgrupo = grupoQUBR.querySelector('.subgrupo');
            subgrupo.style.display = qubrSelect.value ? 'block' : 'none';
        });

        carregarQUEX();
        carregarQUVZ();
    }

    const qulnSelect = document.getElementById('QULN');
    if (qulnSelect) {
        qulnSelect.addEventListener('change', carregarQUBR);
        qulnSelect.addEventListener('change', carregarQUOPC);
    }

    function carregarQUEX() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const grupoQUEX = document.getElementById('GrupoQUEX');
        const quexSelect = document.getElementById('QUEX');
        const optionS = quexSelect?.querySelector('option[value="S"]');

        if (qubr) {
            grupoQUEX.style.display = 'block';
            quexSelect.value = 'N';

            if (optionS) {
                optionS.style.display = (quln === '1.QP') ? 'inline' : 'none';
                if (quexSelect.value === 'S' && quln !== '1.QP') {
                    quexSelect.value = 'N';
                }
            }

            if (['375', '475', '575', '754', '755'].includes(qubr)) {
                carregarQUVZ();
            } else {
                carregarQURD();
            }
        } else {
            grupoQUEX.style.display = 'none';
        }
    }

    const qubrSelect = document.getElementById('QUBR');
    if (qubrSelect) {
        qubrSelect.addEventListener('change', carregarQUEX);
        qubrSelect.addEventListener('change', carregarQUOPC);
    }

    async function carregarQUVZ() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const grupoQUVZ = document.getElementById('GrupoQUVZ');
        const quvzSelect = document.getElementById('QUVZ');

        if (!['375', '475', '575', '754', '755'].includes(qubr)) {
            grupoQUVZ.style.display = 'none';
            quvzSelect.innerHTML = '';
            return;
        }

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/QUVZ.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}`);
        const optionsHTML = await response.text();
        quvzSelect.innerHTML = optionsHTML;

        grupoQUVZ.style.display = 'block';
        quvzSelect.disabled = false;

        const defaultOption = quvzSelect.querySelector('option[value="30MM"]');
        quvzSelect.value = defaultOption ? '30MM' : '';

        quvzSelect.dispatchEvent(new Event('change'));

        carregarQURD();
    }

    const quexSelect = document.getElementById('QUEX');
    if (quexSelect) {
        quexSelect.addEventListener('change', () => {
            const qubr = document.getElementById('QUBR')?.value;
            if (!['375', '475', '575', '754', '755'].includes(qubr)) {
                carregarQURD();
            }
        });

        carregarQURD();
    }

    async function carregarQURD() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const quvz = document.getElementById('QUVZ')?.value || '';
        const qurdSelect = document.getElementById('QURD');
        const grupoQURD = document.getElementById('GrupoQURD');

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/QURD.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}&QUVZ=${encodeURIComponent(quvz)}`);
        const optionsHTML = await response.text();

        qurdSelect.innerHTML = optionsHTML;
        qurdSelect.disabled = false;
        qurdSelect.value = '';

        qurdSelect.addEventListener('change', () => {
            const subgrupo = grupoQURD.querySelector('.subgrupo');
            subgrupo.style.display = qurdSelect.value ? 'block' : 'none';
            carregarQURD1();
            carregarQURD2();
        });

    }

    async function carregarQURD1() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const quvz = document.getElementById('QUVZ')?.value || '';
        const qurd = document.getElementById('QURD')?.value;
        const grupoQURD1 = document.getElementById('GrupoQURD1');
        const qurd1Select = document.getElementById('QURD1');
        const grupoQURD2 = document.getElementById('GrupoQURD2');

        if (qurd) {
            grupoQURD1.style.display = 'block';
            grupoQURD2.style.display = 'block';
            const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/QURD1.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}&QUVZ=${encodeURIComponent(quvz)}&QURD=${encodeURIComponent(qurd)}`);
            const optionsHTML = await response.text();
            qurd1Select.innerHTML = optionsHTML;
            qurd1Select.value = '';
        } else {
            grupoQURD1.style.display = 'none';
            grupoQURD2.style.display = 'none';
        }

        qurd1Select.dispatchEvent(new Event('change'));
        document.getElementById('QURD1')?.addEventListener('change', carregarQURD2);
        carregarQUCM();
    }

    async function carregarQURD2() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const quvz = document.getElementById('QUVZ')?.value || '';
        const qurd = document.getElementById('QURD')?.value;
        const qurd1 = document.getElementById('QURD1')?.value;
        const grupoQURD2 = document.getElementById('GrupoQURD2');
        const qurd2Select = document.getElementById('QURD2');

        grupoQURD2.style.display = 'block';
        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/QURD2.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}&QUVZ=${encodeURIComponent(quvz)}&QURD=${encodeURIComponent(qurd)}&QURD1=${encodeURIComponent(qurd1)}`);
        const optionsHTML = await response.text();
        qurd2Select.innerHTML = optionsHTML;

        qurd2Select.dispatchEvent(new Event('change'));

        carregarQUCM();
    }

    async function carregarQUCM() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const quvz = document.getElementById('QUVZ')?.value || '';
        const qurd = document.getElementById('QURD')?.value;
        const qurd1 = document.getElementById('QURD1')?.value;
        const grupoQUCM = document.getElementById('GrupoQUCM');
        const qucmSelect = document.getElementById('QUCM');

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/QUCM.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}&QUVZ=${encodeURIComponent(quvz)}&QURD=${encodeURIComponent(qurd)}&QURD1=${encodeURIComponent(qurd1)}`);
        const optionsHTML = await response.text();
        qucmSelect.innerHTML = optionsHTML;

        grupoQUCM.style.display = 'block';
        qucmSelect.disabled = false;
        qucmSelect.value = '';

        qucmSelect.addEventListener('change', () => {
            const subgrupo = grupoQUCM.querySelector('.subgrupo');
            subgrupo.style.display = qucmSelect.value ? 'block' : 'none';

            carregarQUBU();
            carregarQUCM2();
        });
    }

    async function carregarQUBU() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const quvz = document.getElementById('QUVZ')?.value || '';
        const qurd = document.getElementById('QURD')?.value;
        const qurd1 = document.getElementById('QURD1')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const qucp = document.getElementById('QUCP')?.value || '';
        const grupoQUBU = document.getElementById('GrupoQUBU');
        const qubuSelect = document.getElementById('QUBU');


        if ((qucm && qucm.includes('EE')) || (qucp && qucp.includes('EE'))) {
            grupoQUBU.style.display = 'none';
            qubuSelect.innerHTML = '';
            qubuSelect.disabled = true;
            return;
        }

        const url = `/Paginas/Seletores/Configuradores/QUDR/QUBU.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}&QUVZ=${encodeURIComponent(quvz)}&QURD=${encodeURIComponent(qurd)}&QURD1=${encodeURIComponent(qurd1)}&QUCM=${encodeURIComponent(qucm)}&QUCP=${encodeURIComponent(qucp)}`;
        const response = await fetch(url);

        const optionsHTML = await response.text();
        qubuSelect.innerHTML = optionsHTML;

        grupoQUBU.style.display = 'block';
        qubuSelect.disabled = false;

        const optNao = qubuSelect.querySelector('option[value="N"]');
        if (optNao) {
            qubuSelect.value = 'N';
        } else {
            qubuSelect.value = '';
        }


        qubuSelect.dispatchEvent(new Event('change'));
    }

    async function carregarQUCM2() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const grupoQUCM2 = document.getElementById('GrupoQUCM2');
        const qucm2Select = document.getElementById('QUCM2');

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/QUCM2.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}`);
        const optionsHTML = await response.text();
        qucm2Select.innerHTML = optionsHTML;

        grupoQUCM2.style.display = 'block';
        qucm2Select.disabled = false;

        qucm2Select.dispatchEvent(new Event('change'));

        carregarQUBU2();
    }

    async function carregarQUBU2() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const quvz = document.getElementById('QUVZ')?.value || '';
        const qurd = document.getElementById('QURD')?.value;
        const qurd2 = document.getElementById('QURD2')?.value;
        const qucm2 = document.getElementById('QUCM2')?.value;
        const grupoQUBU2 = document.getElementById('GrupoQUBU2');
        const qubu2Select = document.getElementById('QUBU2');

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/QUBU2.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}&QUVZ=${encodeURIComponent(quvz)}&QURD=${encodeURIComponent(qurd)}&QURD2=${encodeURIComponent(qurd2)}&QUCM2=${encodeURIComponent(qucm2)}`);
        const optionsHTML = await response.text();
        qubu2Select.innerHTML = optionsHTML;

        grupoQUBU2.style.display = 'block';
        qubu2Select.disabled = false;

        const optN = qubu2Select.querySelector('option[value="N"]');
        if (optN) {
            qubu2Select.value = 'N';
        } else if (qubu2Select.options.length > 0) {
            qubu2Select.selectedIndex = 0;
        }

        qubu2Select.dispatchEvent(new Event('change'));
    }

    const qurd2Select = document.getElementById('QURD2');
    if (qurd2Select) qurd2Select.addEventListener('change', carregarQUCM);

    const qucmSelect = document.getElementById('QUCM');
    if (qucmSelect) qucmSelect.addEventListener('change', carregarQUBU);

    const qubuSelect = document.getElementById('QUBU');
    if (qubuSelect) qubuSelect.addEventListener('change', carregarQUCP);

    async function carregarQUUN() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const grupoQUUN = document.getElementById('GrupoQUUN');
        const quunSelect = document.getElementById('QUUN');

        if (quln !== '1.QP') {
            grupoQUUN.style.display = 'none';
            quunSelect.innerHTML = '';
            quunSelect.disabled = true;
            return;
        }

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/QUUN.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}`);
        const optionsHTML = await response.text();

        quunSelect.innerHTML = optionsHTML;
        grupoQUUN.style.display = 'block';
        quunSelect.disabled = false;
        quunSelect.value = '';
        quunSelect.dispatchEvent(new Event('change'));
    }

    document.getElementById('QULN')?.addEventListener('change', carregarQUUN);
    document.getElementById('QUBR')?.addEventListener('change', carregarQUUN);

    async function carregarQUCP() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const quvz = document.getElementById('QUVZ')?.value || '';
        const qurd = document.getElementById('QURD')?.value;
        const qurd1 = document.getElementById('QURD1')?.value || '';

        const grupoQUCP = document.getElementById('GrupoQUCP');
        const qucpSelect = document.getElementById('QUCP');


        if (qucm.includes('EE')) {
            grupoQUCP.style.display = 'none';
            qucpSelect.innerHTML = '';
            qucpSelect.disabled = true;
            return;
        }

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/QUCP.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}&QUCM=${encodeURIComponent(qucm)}&QUVZ=${encodeURIComponent(quvz)}&QURD=${encodeURIComponent(qurd)}&QURD1=${encodeURIComponent(qurd1)}`);

        const optionsHTML = await response.text();
        qucpSelect.innerHTML = optionsHTML;
        qucpSelect.disabled = false;
        qucpSelect.value = '';
    }

    const qucpSelect = document.getElementById('QUCP');
    if (qucpSelect) {
        qucpSelect.addEventListener('change', () => {
            const grupoQUBU = document.getElementById('GrupoQUBU');
            const qubuSelect = document.getElementById('QUBU');
            if (!qubuSelect || !grupoQUBU) return;
            const valorSelecionado = qucpSelect.value;
            grupoQUBU.style.display = valorSelecionado.includes("EE") ? 'none' : 'block';
        });

        qucpSelect.addEventListener('change', carregarQUAF);
    }

    async function carregarQUAF() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const quvz = document.getElementById('QUVZ')?.value || '';
        const qurd = document.getElementById('QURD')?.value;

        const grupoQUAF = document.getElementById('GrupoQUAF');
        const quafSelect = document.getElementById('QUAF');

        const url = `/Paginas/Seletores/Configuradores/QUDR/QUAF.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}&QUVZ=${encodeURIComponent(quvz)}&QURD=${encodeURIComponent(qurd)}`;
        const response = await fetch(url);
        const optionsHTML = await response.text();

        quafSelect.innerHTML = optionsHTML;
        grupoQUAF.style.display = 'block';
        quafSelect.disabled = false;

        const optN = quafSelect.querySelector('option[value="N"]');
        if (optN) {
            quafSelect.value = 'N';
        } else if (quafSelect.options.length > 0) {
            quafSelect.selectedIndex = 0;
        }

        quafSelect.dispatchEvent(new Event('change'));
        carregarQUAS();
    }

    function carregarQUAFP() {
        const quafSelect = document.getElementById('QUAF');
        const grupoQUAFP = document.getElementById('GrupoQUAFP');
        const quafpSelect = document.getElementById('QUAFP');
        const subgrupoQUAF = document.querySelector('#GrupoQUAF .subgrupo');

        const valor = quafSelect.value;

        if (valor && valor !== 'N') {
            grupoQUAFP.style.display = 'block';
            quafpSelect.value = 'A';
            if (subgrupoQUAF) subgrupoQUAF.style.display = 'block';
        } else {
            grupoQUAFP.style.display = 'none';
            quafpSelect.value = '';
            if (subgrupoQUAF) subgrupoQUAF.style.display = 'none';
        }

        carregarQUBT();
    }

    function carregarQUBT() {
        const quafSelect = document.getElementById('QUAF');
        const grupoQUBT = document.getElementById('GrupoQUBT');
        const qubtSelect = document.getElementById('QUBT');
        const qubr = document.getElementById('QUBR')?.value;

        const opt2 = document.getElementById('optQUBT2');
        const opt4 = document.getElementById('optQUBT4');

        if (quafSelect.value === 'BT') {
            grupoQUBT.style.display = 'block';
            qubtSelect.value = '1';

            const ocultar = qubr === '025' || qubr === '150';
            if (opt2) opt2.style.display = ocultar ? 'none' : 'inline';
            if (opt4) opt4.style.display = ocultar ? 'none' : 'inline';
        } else {
            grupoQUBT.style.display = 'none';
        }
    }

    const quafSelect = document.getElementById('QUAF');
    if (quafSelect) quafSelect.addEventListener('change', () => {
        carregarQUAFP();
        carregarQUBT();
        carregarQUCL();
    });

    async function carregarQUAS() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const quvz = document.getElementById('QUVZ')?.value || '';
        const qurd = document.getElementById('QURD')?.value;

        const grupoQUAS = document.getElementById('GrupoQUAS');
        const quasSelect = document.getElementById('QUAS');

        const url = `/Paginas/Seletores/Configuradores/QUDR/QUAS.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}&QUVZ=${encodeURIComponent(quvz)}&QURD=${encodeURIComponent(qurd)}`;
        const response = await fetch(url);
        const optionsHTML = await response.text();

        quasSelect.innerHTML = optionsHTML;
        grupoQUAS.style.display = 'block';
        quasSelect.disabled = false;

        const optN = quasSelect.querySelector('option[value="N"]');
        if (optN) {
            quasSelect.value = 'N';
        } else if (quasSelect.options.length > 0) {
            quasSelect.selectedIndex = 0;
        }

        quasSelect.dispatchEvent(new Event('change'));
    }


    const quasSelect = document.getElementById('QUAS');
    if (quasSelect) {
        quasSelect.addEventListener('change', carregarQAUSP);
    }

    function carregarQAUSP() {
        const quasSelect = document.getElementById('QUAS');
        const grupoQUASP = document.getElementById('GrupoQUASP');
        const quaspSelect = document.getElementById('QUASP');
        const subgrupoQUAS = document.querySelector('#GrupoQUAS .subgrupo');

        const valor = quasSelect.value;
        const mostrar = !['N', 'ED', 'ED30'].includes(valor);

        if (mostrar) {
            grupoQUASP.style.display = 'block';
            quaspSelect.value = 'A';
            if (subgrupoQUAS) subgrupoQUAS.style.display = 'block';
        } else {
            grupoQUASP.style.display = 'none';
            quaspSelect.value = '';
            if (subgrupoQUAS) subgrupoQUAS.style.display = 'none';
        }
    }

    function carregarQUCLVER() {
        const quaf = document.getElementById('QUAF')?.value;
        const quafp = document.getElementById('QUAFP')?.value || '';
        const quas = document.getElementById('QUAS')?.value;
        const quasp = document.getElementById('QUASP')?.value || '';

        const capa1 = (quaf === "N") ? "" : quafp;
        const capa2 = (quas === "N") ? "" : quasp;
        const quclver = `${capa1}-${capa2}`;

        const permiteA = ["-", "-B", "B-B", "B-"].includes(quclver);
        const permiteB = ["-", "-A", "A-A", "A-"].includes(quclver);
        const permitirCP = permiteA || permiteB;

        return { quclver, permiteA, permiteB, permitirCP };
    }

    function carregarQUCL() {
        const qubr = document.getElementById('QUBR')?.value;
        const quas = document.getElementById('QUAS')?.value;
        const quclSelect = document.getElementById('QUCL');
        const grupoQUCL = document.getElementById('GrupoQUCL');

        const { permiteA, permiteB } = carregarQUCLVER();

        const permitirCP = permiteA || permiteB;

        const liberarCP = (
            qubr !== "025" &&
            quas !== "ED" &&
            quas !== "ED30" &&
            permitirCP
        );

        quclSelect.innerHTML = '';
        quclSelect.disabled = false;

        quclSelect.appendChild(new Option("NÃO", "N"));
        if (liberarCP) {
            quclSelect.appendChild(new Option("SIM", "CP"));
        }

        quclSelect.value = "N";
        grupoQUCL.style.display = 'block';
        quclSelect.dispatchEvent(new Event('change'));
    }

    function carregarQUCLP() {
        const qucl = document.getElementById('QUCL')?.value;
        const grupoQUCLP = document.getElementById('GrupoQUCLP');
        const quclpSelect = document.getElementById('QUCLP');
        const subgrupoQUCL = document.querySelector('#GrupoQUCL .subgrupo');

        if (qucl !== "CP") {
            grupoQUCLP.style.display = 'none';
            if (subgrupoQUCL) subgrupoQUCL.style.display = 'none';
            return;
        }

        grupoQUCLP.style.display = 'block';
        if (subgrupoQUCL) subgrupoQUCL.style.display = 'block';

        const { permiteA, permiteB } = carregarQUCLVER();

        quclpSelect.innerHTML = '';
        if (permiteA) quclpSelect.appendChild(new Option("DIREITA", "A"));
        if (permiteB) quclpSelect.appendChild(new Option("ESQUERDA", "B"));

        if (!permiteA && !permiteB) {
            grupoQUCLP.style.display = 'none';
            if (subgrupoQUCL) subgrupoQUCL.style.display = 'none';
            return;
        }

        quclpSelect.disabled = false;
        quclpSelect.value = '';
    }

    document.addEventListener('DOMContentLoaded', () => {
        const quclSelect = document.getElementById('QUCL');
        if (quclSelect) {
            quclSelect.addEventListener('change', carregarQUCLP);
            quclSelect.addEventListener('change', carregarQUOPC);
        }

        const quclpSelect = document.getElementById('QUCLP');
        if (quclpSelect) {
            quclpSelect.addEventListener('change', carregarQUOPC);
        }

    });

    document.addEventListener('DOMContentLoaded', () => {
        const qubrSelect = document.getElementById('QUBR');
        const quasSelect = document.getElementById('QUAS');
        const quafpSelect = document.getElementById('QUAFP');
        const quaspSelect = document.getElementById('QUASP');

        if (qubrSelect) qubrSelect.addEventListener('change', carregarQUCL);
        if (quasSelect) quasSelect.addEventListener('change', carregarQUCL);
        if (quafpSelect) quafpSelect.addEventListener('change', carregarQUCL);
        if (quaspSelect) quaspSelect.addEventListener('change', carregarQUCL);
    });

    async function carregarQUPOC() {
        const quln = document.getElementById('QULN')?.value;
        const grupoQUPOC = document.getElementById('GrupoQUPOC');
        const qupocSelect = document.getElementById('QUPOC');
        const subgrupoQUPOC = grupoQUPOC.querySelector('.subgrupo');

        if (quln !== '1.QDR') {
            grupoQUPOC.style.display = 'none';
            qupocSelect.disabled = true;
            qupocSelect.value = '';
            if (subgrupoQUPOC) subgrupoQUPOC.style.display = 'none';
            return;
        }

        grupoQUPOC.style.display = 'block';
        qupocSelect.disabled = false;

        const optZ = qupocSelect.querySelector('option[value="Z"]');
        if (optZ) {
            qupocSelect.value = 'Z';
        } else {
            qupocSelect.selectedIndex = 0;
        }

        if (subgrupoQUPOC) subgrupoQUPOC.style.display = 'block';
        qupocSelect.dispatchEvent(new Event('change'));
        carregarQUPOL();
    }

    async function carregarQUPOL() {
        const grupoQUPOL = document.getElementById('GrupoQUPOL');
        const qupolSelect = document.getElementById('QUPOL');

        grupoQUPOL.style.display = 'block';
        qupolSelect.disabled = false;

        const opt1 = qupolSelect.querySelector('option[value="1"]');
        if (opt1) {
            qupolSelect.value = '1';
        } else {
            qupolSelect.selectedIndex = 0;
        }

        qupolSelect.dispatchEvent(new Event('change'));
    }

    document.getElementById('QULN')?.addEventListener('change', carregarQUPOC);
    document.getElementById('QUPOC')?.addEventListener('change', carregarQUPOL);

    function carregarQUOPC() {
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const qucl = document.getElementById('QUCL')?.value;
        const quclp = document.getElementById('QUCLP')?.value || '';
        const quupl = document.getElementById('QUPL')?.value || '';
        const grupoQUOPC = document.getElementById('GrupoQUOPC');

        grupoQUOPC.style.display = 'block';

        const labelRT = document.getElementById('lblRT');
        const checkboxRT = labelRT?.querySelector('input');
        if (labelRT && checkboxRT) {
            if (quupl === "N") {
                labelRT.style.display = 'block';
            } else {
                labelRT.style.display = 'none';
                checkboxRT.checked = false;
            }
        }

        validarQUOPC();
        carregarQUMO();
        carregarQUVA();
        carregarQUPL();
    }

    function validarQUOPC() {
        const checkboxes = document.querySelectorAll('#checklistQUOPC input[type="checkbox"]');
        let selecionados = Array.from(checkboxes)
            .filter(cb => cb.checked)
            .map(cb => cb.value);

        if (selecionados.includes("NÃO") && selecionados.length > 1) {
            document.querySelector('input[name="QUOPC"][value="NÃO"]').checked = false;
            selecionados = selecionados.filter(v => v !== "NÃO");
        }

        if (selecionados.length === 0) {
            document.querySelector('input[name="QUOPC"][value="NÃO"]').checked = true;
            selecionados = ["NÃO"];
        }

        if (selecionados.includes("ACOR") && selecionados.includes("PINTCZ")) {
            document.querySelector('input[name="QUOPC"][value="ACOR"]').checked = false;
            selecionados = selecionados.filter(v => v !== "ACOR");
        }

        document.getElementById('QUOPC').value = selecionados.join(',');

        const nomesVisiveis = selecionados.map(valor => {
            const label = Array.from(document.querySelectorAll('#checklistQUOPC label')).find(lbl =>
                lbl.querySelector(`input[value="${valor}"]`)
            );
            return label ? label.textContent.trim() : valor;
        });

        document.querySelector('#dropdownQUOPC .dropdown-button').textContent = nomesVisiveis.join(', ');

        document.getElementById('QUOPC').dispatchEvent(new Event('change'));
    }

    document.querySelectorAll('#checklistQUOPC input[type="checkbox"]').forEach(cb => {
        cb.addEventListener('change', validarQUOPC);
    });

    const quopcSelect = document.getElementById('QUOPC');
    if (quopcSelect) {
        quopcSelect.addEventListener('change', () => {
            setTimeout(() => {
                carregarQUMO();
                carregarQUVA();
                carregarQUPL()
            }, 10);
        });
    }

    window.toggleDropdown = function (button) {
        const list = button.nextElementSibling;
        list.style.display = list.style.display === 'block' ? 'none' : 'block';
    };

    document.addEventListener('click', function (e) {
        document.querySelectorAll('.dropdown-checkbox').forEach(dropdown => {
            if (!dropdown.contains(e.target)) {
                dropdown.querySelector('.dropdown-list').style.display = 'none';
            }
        });
    });

    window.addEventListener('load', () => {
        const grupoQUOPC = document.getElementById('GrupoQUOPC');
        if (grupoQUOPC?.style.display === 'block') {
            carregarQUMO();
            carregarQUVA();
            carregarQUPL();
        }
    });

    function carregarQUMO() {
        const qucm = document.getElementById('QUCM')?.value;
        const qucp = document.getElementById('QUCP')?.value;
        const qupl = document.getElementById('QUPL')?.value;
        const qumoSelect = document.getElementById('QUMO');
        const grupoQUMO = document.getElementById('GrupoQUMO');

        const permitirS = (
            qupl === "N" &&
            (!qucp.includes("EE") && !qucm.includes("EE")) &&
            qucp !== "B"
        );

        qumoSelect.innerHTML = '';
        qumoSelect.disabled = false;

        if (permitirS) {
            qumoSelect.appendChild(new Option("SIM", "S"));
        }

        qumoSelect.appendChild(new Option("NÃO", "N"));
        qumoSelect.value = "N";

        grupoQUMO.style.display = 'block';
        grupoQUMO.dispatchEvent(new Event('change'));

        carregarMOLN();
    }

    const qumoSelect = document.getElementById('QUMO');
    if (qumoSelect) {
        qumoSelect.addEventListener('change', carregarMOLN);
    }

    async function carregarMOLN() {
        const qumoSelect = document.getElementById('QUMO');
        const qucp = document.getElementById('QUCP')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const grupoMOLN = document.getElementById('GrupoMOLN');
        const molnSelect = document.getElementById('MOLN');
        const subgrupoQUMO = document.querySelector('#GrupoQUMO .subgrupo');

        if (qumoSelect.value === "S") {
            grupoMOLN.style.display = 'block';
            if (subgrupoQUMO) subgrupoQUMO.style.display = 'block';

            const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/MOLN.php?QUCM=${encodeURIComponent(qucm)}&QUCP=${encodeURIComponent(qucp)}`);

            const optionsHTML = await response.text();
            molnSelect.innerHTML = optionsHTML;

            molnSelect.style.display = 'block';
            molnSelect.disabled = false;
            molnSelect.dispatchEvent(new Event('change'));
        } else {
            grupoMOLN.style.display = 'none';
            if (subgrupoQUMO) subgrupoQUMO.style.display = 'none';
            molnSelect.style.display = 'none';
        }

        carregarMOTP();
        carregarMOOPC();
    }

    const molnSelect = document.getElementById('MOLN');
    if (molnSelect) {
        molnSelect.addEventListener('change', carregarMOTP);
        molnSelect.addEventListener('change', carregarMOOPC);
    }

    async function carregarMOTP() {
        const moln = document.getElementById('MOLN')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const qucp = document.getElementById('QUCP')?.value;
        const grupoMOTP = document.getElementById('GrupoMOTP');
        const motpSelect = document.getElementById('MOTP');

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/MOTP.php?MOLN=${encodeURIComponent(moln)}&QUCM=${encodeURIComponent(qucm)}&QUCP=${encodeURIComponent(qucp)}`);
        if (!response.ok) throw new Error('Erro ao buscar opções de MOTP');

        const optionsHTML = await response.text();
        motpSelect.innerHTML = optionsHTML;

        grupoMOTP.style.display = 'block';
        motpSelect.style.display = 'block';
        motpSelect.disabled = false;

        carregarMOTT();
    }

    const motpSelect = document.getElementById('MOTP');
    if (motpSelect) {
        motpSelect.addEventListener('change', carregarMOTT);
    }

    async function carregarMOTT() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const qucp = document.getElementById('QUCP')?.value;
        const grupoMOTT = document.getElementById('GrupoMOTT');
        const mottSelect = document.getElementById('MOTT');
        const subgrupoQUMO = document.querySelector('#GrupoQUMO .subgrupo');

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/MOTT.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&QUCM=${encodeURIComponent(qucm)}&QUCP=${encodeURIComponent(qucp)}`);

        const optionsHTML = await response.text();
        mottSelect.innerHTML = optionsHTML;

        grupoMOTT.style.display = 'block';
        mottSelect.style.display = 'block';
        mottSelect.disabled = false;
        mottSelect.value = '';

        carregarMOFQ();
    }

    const mottSelect = document.getElementById('MOTT');
    if (mottSelect) {
        mottSelect.addEventListener('change', carregarMOFQ);
    }

    async function carregarMOFQ() {

        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const qucp = document.getElementById('QUCP')?.value;
        const grupoMOFQ = document.getElementById('GrupoMOFQ');
        const mofqSelect = document.getElementById('MOFQ');

        const response = await fetch(
            `/Paginas/Seletores/Configuradores/QUDR/MOFQ.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}&QUCM=${encodeURIComponent(qucm)}&QUCP=${encodeURIComponent(qucp)}`
        );

        if (!response.ok) throw new Error('Erro ao buscar opções de MOFQ');

        const optionsHTML = await response.text();
        mofqSelect.innerHTML = optionsHTML;

        grupoMOFQ.style.display = 'block';
        mofqSelect.style.display = 'block';
        mofqSelect.disabled = false;
        mofqSelect.value = '';

        carregarMOPT();
    }

    const mofqSelect = document.getElementById('MOFQ');
    if (mofqSelect) {
        mofqSelect.addEventListener('change', carregarMOPT);
    }

    async function carregarMOPT() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const mofq = document.getElementById('MOFQ')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const qucp = document.getElementById('QUCP')?.value;
        const grupoMOPT = document.getElementById('GrupoMOPT');
        const moptSelect = document.getElementById('MOPT');

        const response = await fetch(
            `/Paginas/Seletores/Configuradores/QUDR/MOPT.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}&MOFQ=${encodeURIComponent(mofq)}&QUCM=${encodeURIComponent(qucm)}&QUCP=${encodeURIComponent(qucp)}`
        );

        if (!response.ok) throw new Error('Erro ao buscar opções de MOPT');

        const optionsHTML = await response.text();
        moptSelect.innerHTML = optionsHTML;

        grupoMOPT.style.display = 'block';
        moptSelect.style.display = 'block';
        moptSelect.disabled = false;
        moptSelect.value = '';

        carregarMOPL();
    }

    const moptSelect = document.getElementById('MOPT');
    if (moptSelect) {
        moptSelect.addEventListener('change', carregarMOPL);
    }

    async function carregarMOPL() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const mofq = document.getElementById('MOFQ')?.value;
        const mopt = document.getElementById('MOPT')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const qucp = document.getElementById('QUCP')?.value;
        const grupoMOPL = document.getElementById('GrupoMOPL');
        const moplSelect = document.getElementById('MOPL');

        const response = await fetch(
            `/Paginas/Seletores/Configuradores/QUDR/MOPL.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}&MOFQ=${encodeURIComponent(mofq)}&MOPT=${encodeURIComponent(mopt)}&QUCM=${encodeURIComponent(qucm)}&QUCP=${encodeURIComponent(qucp)}`
        );

        const optionsHTML = await response.text();
        moplSelect.innerHTML = optionsHTML;

        grupoMOPL.style.display = 'block';
        moplSelect.style.display = 'block';
        moplSelect.disabled = false;
        moplSelect.value = '';

        carregarMOCP();
    }

    const moplSelect = document.getElementById('MOPL');
    if (moplSelect) {
        moplSelect.addEventListener('change', carregarMOCP);
    }

    async function carregarMOCP() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const mofq = document.getElementById('MOFQ')?.value;
        const mopt = document.getElementById('MOPT')?.value;
        const mopl = document.getElementById('MOPL')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const qucp = document.getElementById('QUCP')?.value;
        const grupoMOCP = document.getElementById('GrupoMOCP');
        const mocpSelect = document.getElementById('MOCP');

        const response = await fetch(
            `/Paginas/Seletores/Configuradores/QUDR/MOCP.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}&MOFQ=${encodeURIComponent(mofq)}&MOPT=${encodeURIComponent(mopt)}&MOPL=${encodeURIComponent(mopl)}&QUCM=${encodeURIComponent(qucm)}&QUCP=${encodeURIComponent(qucp)}`
        );

        const optionsHTML = await response.text();
        mocpSelect.innerHTML = optionsHTML;

        grupoMOCP.style.display = 'block';
        mocpSelect.style.display = 'block';
        mocpSelect.disabled = false;
        mocpSelect.value = qucp;
        mocpSelect.dispatchEvent(new Event('change'));

        carregarMOCPP();
        carregarMOPC();
    }

    function carregarMOCPP() {
        const moln = document.getElementById('MOLN')?.value;
        const mocp = document.getElementById('MOCP')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const grupoMOCPP = document.getElementById('GrupoMOCPP');
        const divSubgrupo = document.querySelector('.SubgrupoMOCP');
        const mocppSelect = document.getElementById('MOCPP');

        const deveExibir = moln !== "3.W" && ["B3", "B34", "B35"].includes(mocp);

        if (deveExibir) {

            mocppSelect.innerHTML = '';

            mocppSelect.innerHTML += '<option value="T" selected>Topo</option>';

            const bloqueado = moln === "2.I" && qucm === "56";
            if (!bloqueado) {
                mocppSelect.innerHTML += '<option value="D">Direita</option>';
                mocppSelect.innerHTML += '<option value="E">Esquerda</option>';
            }

            divSubgrupo.style.display = 'block';
            grupoMOCPP.style.display = 'block';
        } else {
            divSubgrupo.style.display = 'none';
            grupoMOCPP.style.display = 'none';
        }
        carregarMOPC();
    }

    const mocpSelect = document.getElementById('MOCP');
    if (mocpSelect) {

        mocpSelect.addEventListener('change', carregarMOCPP);
    }
    mocpSelect.addEventListener('change', carregarMOPC);

    function carregarMOPC() {
        const moln = document.getElementById('MOLN')?.value;
        const grupoMOPC = document.getElementById('GrupoMOPC');
        const mopcSelect = document.getElementById('MOPC');

        mopcSelect.innerHTML = '';

        const isAPM = moln === "3.APM" || moln === "3.SPM";

        const rotulos = {
            "CX270": "270°",
            "CX180": "180°",
            "CX90": "90°",
            "CX0": "0°",
            "B3": "B3",
            "B6": "B6",
            "B7": "B7",
            "B8": "B8",
            "V5": "V5",
            "V6": "V6"
        };

        const opcoes = isAPM
            ? ["B3", "B6", "B7", "B8", "V5", "V6"]
            : ["CX270", "CX180", "CX90", "CX0"];

        const valorPadrao = isAPM ? "B3" : "CX270";

        opcoes.forEach(valor => {
            const selected = valor === valorPadrao ? 'selected' : '';
            mopcSelect.innerHTML += `<option value="${valor}" ${selected}>${rotulos[valor]}</option>`;
        });

        grupoMOPC.style.display = 'block';
        mopcSelect.disabled = false;

        carregarMOPP();
    }

    const mopcSelect = document.getElementById('MOPC');
    if (mopcSelect) {

        mopcSelect.addEventListener('change', carregarMOPP);
    }

    function carregarMOPP() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mocp = document.getElementById('MOCP')?.value;
        const grupoMOPP = document.getElementById('GrupoMOPP');
        const moppSelect = document.getElementById('MOPP');

        if (moln === "3.APM" || moln === "3.SPM") {
            grupoMOPP.style.display = 'none';
            return;
        }

        moppSelect.innerHTML = '';

        const opcoes = [
            { valor: "PC1", label: "1" },
            { valor: "PC2", label: "2" },
            { valor: "PC3", label: "3" },
            { valor: "PC4", label: "4" }
        ];

        opcoes.forEach(op => {
            const option = document.createElement('option');
            option.value = op.valor;
            option.textContent = op.label;
            moppSelect.appendChild(option);
        });

        let valorPadrao = "PC1";
        if (moln === "3.I" || (moln === "2.I" && motp === "T")) valorPadrao = "PC1";
        else if (moln === "2.I" && motp === "M") valorPadrao = "PC2";
        else if (moln === "3.W") valorPadrao = "PC3";

        moppSelect.value = valorPadrao;

        grupoMOPP.style.display = 'block';
        moppSelect.disabled = false;

        carregarMOOPC();
    }

    const moppSelect = document.getElementById('MOPP');
    if (moppSelect) {

        moppSelect.addEventListener('change', carregarMOOPC);
    }

    function carregarMOOPC() {
        const moln = document.getElementById('MOLN')?.value.trim();
        const qucm = document.getElementById('QUCM')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const grupoMOPP = document.getElementById('GrupoMOPP');
        const grupoMOOPC = document.getElementById('GrupoMOOPC');
        const checklist = document.querySelectorAll('#checklistMOOPC input[type="checkbox"]');

        if (!grupoMOPP || grupoMOPP.style.display !== 'block' || !grupoMOOPC) {
            grupoMOOPC.style.display = 'none';
            return;
        }

        grupoMOOPC.style.display = 'block';

        checklist.forEach(cb => {
            const value = cb.value;
            let mostrar = true;

            if (["ACOR", "PINTCZ"].includes(value) && (moln === "3.APM" || moln === "3.SPM")) {
                mostrar = false;
            }

            if (value === "VF") {
                mostrar = (moln === "2.I" && ["63", "71"].includes(qucm)) ||
                    (moln === "3.I" && motp !== "F" && ["63", "71", "80", "90", "100-112", "132"].includes(qucm));
            }

            if (value === "CR") {
                mostrar = (moln === "3.W" && ["80", "90", "100-112", "132"].includes(qucm)) ||
                    (moln === "3.I" && ["80", "90", "100-112"].includes(qucm));
            }

            cb.closest('label').style.display = mostrar ? 'block' : 'none';

            if (!mostrar) cb.checked = false;
        });

        validarMOOPC();
        carregarMOCR();
    }

    const moopcSelect = document.getElementById('MOOPC');
    if (moopcSelect) {
        moopcSelect.addEventListener('change', carregarMOCR);
        moopcSelect.addEventListener('change', validarMOOPC);
    }

    function validarMOOPC() {
        const checkboxes = document.querySelectorAll('#checklistMOOPC input[type="checkbox"]');
        let selecionados = Array.from(checkboxes)
            .filter(cb => cb.checked)
            .map(cb => cb.value);

        if (selecionados.includes("NÃO") && selecionados.length > 1) {
            document.querySelector('input[name="MOOPC"][value="NÃO"]').checked = false;
            selecionados = selecionados.filter(v => v !== "NÃO");
        }

        if (selecionados.length === 0) {
            document.querySelector('input[name="MOOPC"][value="NÃO"]').checked = true;
            selecionados = ["NÃO"];
        }

        if (selecionados.includes("ACOR") && selecionados.includes("PINTCZ")) {
            document.querySelector('input[name="MOOPC"][value="ACOR"]').checked = false;
            selecionados = selecionados.filter(v => v !== "ACOR");
        }

        document.getElementById('MOOPC').value = selecionados.join(',');

        const nomesVisiveis = selecionados.map(valor => {
            const label = Array.from(document.querySelectorAll('#checklistMOOPC label')).find(lbl =>
                lbl.querySelector(`input[value="${valor}"]`)
            );
            return label ? label.textContent.trim() : valor;
        });

        document.querySelector('#dropdownMOOPC .dropdown-button').textContent = nomesVisiveis.join(', ');

        carregarMOCR();
    }

    document.getElementById('MOOPC').dispatchEvent(new Event('change'));

    document.addEventListener('DOMContentLoaded', () => {
        const checkboxes = document.querySelectorAll('#checklistMOOPC input[type="checkbox"]');
        checkboxes.forEach(cb => {
            cb.addEventListener('change', validarMOOPC);
        });
    });

    function carregarMOCR() {
        const grupoMOCR = document.getElementById('GrupoMOCR');
        const grupoQUCR = document.getElementById('GrupoQUCR');
        const subgrupoMOOPC = document.querySelector('.SubgrupoMOOPC');
        const mocrSelect = document.getElementById('MOCR');
        const moopc = document.getElementById('MOOPC')?.value || '';

        const crSelecionado = moopc.split(',').includes('CR');

        if (!crSelecionado) {
            subgrupoMOOPC.style.display = 'none';
            grupoMOCR.style.display = 'none';
            grupoQUCR.style.display = 'none';
            mocrSelect.value = '';
            return;
        }

        subgrupoMOOPC.style.display = 'block';
        grupoMOCR.style.display = 'block';
        grupoQUCR.style.display = 'none';

        mocrSelect.innerHTML = `
    <option value="H">HORÁRIO</option>
    <option value="AH">ANTI-HORÁRIO</option>
  `;

        mocrSelect.value = '';

        carregarQUCR();
    }

    const mocrSelect = document.getElementById('MOCR');
    if (mocrSelect) {
        mocrSelect.addEventListener('change', carregarQUCR);
    }

    function carregarQUCR() {
        const mocrSelect = document.getElementById('MOCR');
        const grupoQUCR = document.getElementById('GrupoQUCR');
        const qucrSelect = document.getElementById('QUCR');

        const valorMOCR = mocrSelect.value;

        if (!valorMOCR) {
            grupoQUCR.style.display = 'none';
            return;
        }

        const valorQUCR = valorMOCR;
        const textoQUCR = valorQUCR === 'H' ? 'HORÁRIO' : 'ANTI-HORÁRIO';


        qucrSelect.innerHTML = `<option value="${valorQUCR}">${textoQUCR}</option>`;
        grupoQUCR.style.display = 'block';
    }

    function carregarQUVA() {
        const qupl = document.getElementById('QUPL')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const qucp = document.getElementById('QUCP')?.value;
        const quvaSelect = document.getElementById('QUVA');
        const grupoQUVA = document.getElementById('GrupoQUVA');

        const permitirS = qupl === "N" && ["63", "71", "80", "90"].includes(qucm) && qucp === "B5";

        quvaSelect.innerHTML = '';
        quvaSelect.disabled = false;

        if (permitirS) quvaSelect.appendChild(new Option("SIM", "S"));
        quvaSelect.appendChild(new Option("NÃO", "N"));
        quvaSelect.value = "N";
        grupoQUVA.style.display = 'block';

        quvaSelect.dispatchEvent(new Event('change'));

        carregarVALN();
    }

    document.getElementById('QUVA')?.addEventListener('change', carregarVALN);

    async function carregarVALN() {
        const quvaSelect = document.getElementById('QUVA');
        const grupoVALN = document.getElementById('GrupoVALN');
        const valnSelect = document.getElementById('VALN');
        const subgrupoQUVA = document.querySelector('#GrupoQUVA .subgrupo');

        if (quvaSelect.value === "S") {
            grupoVALN.style.display = 'block';
            if (subgrupoQUVA) subgrupoQUVA.style.display = 'block';

            const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/VALN.php`);
            if (!response.ok) throw new Error('Erro ao buscar opções de VALN');
            const optionsHTML = await response.text();
            valnSelect.innerHTML = optionsHTML;
            valnSelect.style.display = 'block';
            valnSelect.disabled = false;
            valnSelect.value = '1.V';
            valnSelect.dispatchEvent(new Event('change'));
        } else {
            grupoVALN.style.display = 'none';
            if (subgrupoQUVA) subgrupoQUVA.style.display = 'none';
            valnSelect.style.display = 'none';
        }
    }

    document.getElementById('VALN')?.addEventListener('change', carregarVAPT);

    async function carregarVAPT() {
        const valn = document.getElementById('VALN')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const grupoVAPT = document.getElementById('GrupoVAPT');
        const vaptSelect = document.getElementById('VAPT');

        grupoVAPT.style.display = 'block';

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/VAPT.php?VALN=${encodeURIComponent(valn)}&QUCM=${encodeURIComponent(qucm)}`);
        if (!response.ok) throw new Error('Erro ao buscar opções de VAPT');
        const optionsHTML = await response.text();
        vaptSelect.innerHTML = optionsHTML;
        vaptSelect.disabled = false;
        vaptSelect.style.display = 'block';
        vaptSelect.dispatchEvent(new Event('change'));
    }

    document.getElementById('VAPT')?.addEventListener('change', carregarVAECP);

    function carregarVAECP() {
        const vapt = document.getElementById('VAPT')?.value;
        const grupoVAECP = document.getElementById('GrupoVAECP');
        const vaecpSelect = document.getElementById('VAECP');
        const subgrupoQUVA = document.querySelector('#GrupoQUVA .subgrupo');

        grupoVAECP.style.display = 'block';
        if (subgrupoQUVA) subgrupoQUVA.style.display = 'block';

        vaecpSelect.disabled = false;
        vaecpSelect.value = 'B5';
        vaecpSelect.dispatchEvent(new Event('change'));
    }

    document.getElementById('VAECP')?.addEventListener('change', carregarVASCP);

    async function carregarVASCP() {
        const valn = document.getElementById('VALN')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const vapt = document.getElementById('VAPT')?.value;
        const qumo = document.getElementById('QUMO')?.value;

        const grupoVASCP = document.getElementById('GrupoVASCP');
        const vascpSelect = document.getElementById('VASCP');
        const subgrupoVAECP = document.querySelector('#GrupoVAECP .subgrupo');

        grupoVASCP.style.display = 'block';
        if (subgrupoVAECP) subgrupoVAECP.style.display = 'block';

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/VASCP.php?VALN=${encodeURIComponent(valn)}&QUCM=${encodeURIComponent(qucm)}&VAPT=${encodeURIComponent(vapt)}&QUMO=${encodeURIComponent(qumo)}`);
        if (!response.ok) throw new Error('Erro ao buscar opções de VASCP');
        const optionsHTML = await response.text();
        vascpSelect.innerHTML = optionsHTML;
        vascpSelect.disabled = false;
        vascpSelect.style.display = 'block';

        const optionExists = Array.from(vascpSelect.options).some(opt => opt.value === qucm);
        vascpSelect.value = optionExists ? qucm : vascpSelect.options[0]?.value || '';

        caregarVAPM();
    }

    document.getElementById('VASCP')?.addEventListener('change', caregarVAPM);

    function caregarVAPM() {
        const vascp = document.getElementById('VASCP')?.value;
        const grupoVAPM = document.getElementById('GrupoVAPM');
        const vapmSelect = document.getElementById('VAPM');

        grupoVAPM.style.display = 'block';
        vapmSelect.disabled = false;
        vapmSelect.style.display = 'block';
        vapmSelect.value = '';
    }

    function carregarQUPL() {
        const qumo = document.getElementById('QUMO')?.value;
        const quva = document.getElementById('QUVA')?.value;
        const qucp = document.getElementById('QUCP')?.value;
        const qubu = document.getElementById('QUBU')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const quplSelect = document.getElementById('QUPL');
        const grupoQUPL = document.getElementById('GrupoQUPL');

        const permitirS = (
            qumo === "N" &&
            quva === "N" &&
            qucp === "B14" &&
            qubu === "N" &&
            ["63", "71", "80", "90", "100-112"].includes(qucm) &&
            (!qucp.includes("EE") && !qucm.includes("EE"))
        );

        quplSelect.innerHTML = '';
        quplSelect.disabled = false;

        if (permitirS) quplSelect.appendChild(new Option("SIM", "S"));
        quplSelect.appendChild(new Option("NÃO", "N"));
        quplSelect.value = "N";
        grupoQUPL.style.display = 'block';

        grupoQUPL.dispatchEvent(new Event('change'));

        carregarPLDE();
    }

    document.getElementById('QUPL')?.addEventListener('change', carregarPLDE);

    async function carregarPLDE() {
        const qupl = document.getElementById('QUPL')?.value;
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const grupoPLDE = document.getElementById('GrupoPLDE');
        const pldeSelect = document.getElementById('PLDE');
        const subgrupoQUPL = document.querySelector('#GrupoQUPL .subgrupo');

        if (qupl === "S") {
            grupoPLDE.style.display = 'block';
            if (subgrupoQUPL) subgrupoQUPL.style.display = 'block';

            const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/PLDE.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}&QUCM=${encodeURIComponent(qucm)}`);
            const optionsHTML = await response.text();
            pldeSelect.innerHTML = optionsHTML;
            pldeSelect.style.display = 'block';
            pldeSelect.disabled = false;
            pldeSelect.value = '';
            pldeSelect.dispatchEvent(new Event('change'));
        } else {
            grupoPLDE.style.display = 'none';
            if (subgrupoQUPL) subgrupoQUPL.style.display = 'none';
            subgrupoQUPL.style.display = 'none';
        }

        carregarPLBU();
    }

    document.getElementById('PLDE')?.addEventListener('change', carregarPLBU);

    async function carregarPLBU() {
        const plde = document.getElementById('PLDE')?.value;
        const quln = document.getElementById('QULN')?.value;
        const qubr = document.getElementById('QUBR')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const grupoPLBU = document.getElementById('GrupoPLBU');
        const plbuSelect = document.getElementById('PLBU');
        const subgrupoPLBU = document.querySelector('#GrupoPLDE .subgrupo');

        if (plde) {
            grupoPLBU.style.display = 'block';
            if (subgrupoPLBU) subgrupoPLBU.style.display = 'block';

            const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/PLBU.php?QULN=${encodeURIComponent(quln)}&QUBR=${encodeURIComponent(qubr)}&QUCM=${encodeURIComponent(qucm)}&PLDE=${encodeURIComponent(plde)}`);
            const optionsHTML = await response.text();
            plbuSelect.innerHTML = optionsHTML;
            plbuSelect.disabled = false;
            plbuSelect.style.display = 'block';
            plbuSelect.value = '';
        } else {
            grupoPLBU.style.display = 'none';
            if (subgrupoPLBU) subgrupoPLBU.style.display = 'none';
        }

        carregarPLGU();
    }

    document.getElementById('PLBU')?.addEventListener('change', carregarPLGU);

    async function carregarPLGU() {
        const qupl = document.getElementById('QUPL')?.value;
        const qucm = document.getElementById('QUCM')?.value;
        const plde = document.getElementById('PLDE')?.value;
        const plbu = document.getElementById('PLBU')?.value;
        const grupoPLGU = document.getElementById('GrupoPLGU');
        const plguSelect = document.getElementById('PLGU');

        grupoPLGU.style.display = 'block';

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/PLGU.php?QUCM=${encodeURIComponent(qucm)}&PLDE=${encodeURIComponent(plde)}&PLBU=${encodeURIComponent(plbu)}`);
        const optionsHTML = await response.text();
        plguSelect.innerHTML = optionsHTML;
        plguSelect.disabled = false;
        plguSelect.style.display = 'block';
        plguSelect.dispatchEvent(new Event('change'));
        plguSelect.value = '';

        carregarPLFU()
    }

    document.getElementById('PLGU')?.addEventListener('change', carregarPLFU);

    async function carregarPLFU() {
        const qucm = document.getElementById('QUCM')?.value;
        const plde = document.getElementById('PLDE')?.value;
        const plbu = document.getElementById('PLBU')?.value;
        const plgu = document.getElementById('PLGU')?.value;
        const grupoPLFU = document.getElementById('GrupoPLFU');
        const plfuSelect = document.getElementById('PLFU');

        grupoPLFU.style.display = 'block';

        const response = await fetch(`/Paginas/Seletores/Configuradores/QUDR/PLFU.php?QUCM=${encodeURIComponent(qucm)}&PLDE=${encodeURIComponent(plde)}&PLBU=${encodeURIComponent(plbu)}&PLGU=${encodeURIComponent(plgu)}`);
        const optionsHTML = await response.text();
        plfuSelect.innerHTML = optionsHTML;
        plfuSelect.disabled = false;
        plfuSelect.style.display = 'block';
        plfuSelect.value = '';
        plfuSelect.dispatchEvent(new Event('change'));
    }

</script>

<script>

    function exibirBotaoCompartilhar() {
        const wrapper = document.getElementById("compartilhar-wrapper");
        if (wrapper) wrapper.style.display = "block";
    }

    function exibirBotaoSolicitarDesenho() {
        document.getElementById("solicitar-wrapper").style.display = "inline-flex";
    }

    function exibirBotaoSolicitarCotacao() {
        const wrapper = document.getElementById("cotacao-wrapper");
        if (wrapper) wrapper.style.display = "block";
    }

    async function gerarCodigoProduto() {
        const TAMANHOREDUTOR = v("QUEX") === "S" ? `E${v("QUBR")}` : v("QUBR");

        const FORMACONSTRUTIVA = v("QUCM").includes("EE") ? "" : v("QUCP");
        const FORMACONSTRUTIVAREDUTOR = (v("QUMO") === "N" && v("QUVA") === "N" && v("QUPL") === "N")
            ? `${v("QUCM")}${FORMACONSTRUTIVA}.`
            : "";

        const UNIAOCARCACAO = v("QULN") === "1.QP" ? `.${v("QUUN")}` : "";

        const POSICAOACESSORIOFIXACAO = v("QUAF") !== "N" ? `.${v("QUAFP")}` : "";
        const POSICAOBRACOTORQUE = v("QUAF") === "BT" ? `.${v("QUBT")}` : "";
        const POSICAOACESSORIOSAIDA = !["N", "ED", "ED30"].includes(v("QUAS")) ? `.${v("QUASP")}` : "";

        const TEMOPCIONAISREDUTOR = (v("QUOPC") === "NÃO" || vazio(v("QUOPC"))) ? "" : `.${v("QUOPC")}`;
        const VARIOSOPCIONAISREDUTOR = contem(TEMOPCIONAISREDUTOR, ",") ? substituir(TEMOPCIONAISREDUTOR, ", ", ".") : TEMOPCIONAISREDUTOR;

        const CAPADEPROTECAO = v("QUCL") === "N" ? "" : `.CP.${v("QUCLP")}`;

        const COORDENADASQDR = v("QULN") === "1.QDR" ? `.${v("QUPOC")}${v("QUPOL")}` : "";
        const COORDENADASPADRAO = (v("QULN") === "1.QDR" && v("QUPOC") === "Z" && v("QUPOL") === "1") ? "" : COORDENADASQDR;

        const VAZADOREDUTOR = v("QUBR").includes("75") ? `.VZ${substituir(v("QUVZ"), "MM", "")}` : "";

        const PESMOTOR = (v("QUMO") === "S" && v("MOLN") !== "3.W" && ["B3", "B34", "B35"].includes(v("MOCP")))
            ? v("MOCPP")
            : "";

        const CARCACA100112 = (v("QUMO") === "S" && v("QUCM") === "100-112")
            ? await get("CARCACA100112.php", {
                MOLN: v("MOLN"),
                MOTP: v("MOTP"),
                MOTT: v("MOTT"),
                MOFQ: v("MOFQ"),
                MOPT: v("MOPT"),
                MOPL: v("MOPL")
            })
            : v("QUCM");

        const CARCACAINICIO = v("QUMO") === "S"
            ? await get("CARCACAINICIO.php", {
                MOLN: v("MOLN"),
                MOTP: v("MOTP"),
                MOTT: v("MOTT"),
                MOFQ: v("MOFQ"),
                MOPT: v("MOPT"),
                MOPL: v("MOPL"),
                MOCM: CARCACA100112
            })
            : "";

        const CARCACAFIM = v("QUMO") === "S"
            ? await get("CARCACAFIM.php", {
                MOLN: v("MOLN"),
                MOTP: v("MOTP"),
                MOTT: v("MOTT"),
                MOFQ: v("MOFQ"),
                MOPT: v("MOPT"),
                MOPL: v("MOPL"),
                MOCM: CARCACA100112
            })
            : "";

        const FORMACONSTRUTIVAMOTORREDUTOR = v("QUMO") === "S"
            ? `${CARCACAINICIO}${CARCACA100112}${CARCACAFIM}${v("MOCP")}${PESMOTOR}.`
            : "";

        const TEMOPCIONAIS = (v("QUMO") === "S" && v("MOOPC") !== "NÃO" && !vazio(v("MOOPC"))) ? `.${v("MOOPC")}` : "";
        const VARIOSOPCIONAIS = contem(TEMOPCIONAIS, ",") ? substituir(TEMOPCIONAIS, ", ", ".") : TEMOPCIONAIS;

        const OPCIONAISPADRAO = contem(VARIOSOPCIONAIS, "CR") ? `${VARIOSOPCIONAIS}${v("MOCR")}` : VARIOSOPCIONAIS;
        const CAIXADELIGACAO = (v("QUMO") === "S" && v("MOPC") !== "CX270") ? `.${v("MOPC")}` : "";

        const PRENSACABO = (v("QUMO") === "S" &&
            !(
                v("MOLN") === "3.APM" || v("MOLN") === "3.SPM" ||
                (v("MOLN") === "3.I" && v("MOPP") === "PC1") ||
                (v("MOLN") === "2.I" && v("MOTP") === "T" && v("MOPP") === "PC1") ||
                (v("MOLN") === "2.I" && v("MOTP") === "M" && v("MOPP") === "PC2") ||
                (v("MOLN") === "3.W" && v("MOPP") === "PC3") ||
                vazio(v("MOPP"))
            )
        ) ? `.${v("MOPP")}` : "";

        const CODIGOMOTOR = v("QUMO") === "S"
            ? `.${v("MOLN")}.${v("MOTP")}.${v("MOTT")}.${v("MOPT")}.${v("MOPL")}.${FORMACONSTRUTIVAMOTORREDUTOR}${v("MOFQ")}${OPCIONAISPADRAO}${CAIXADELIGACAO}${PRENSACABO}`
            : "";

        const FORMACONSTRUTIVAVARIADOR = (v("QUVA") === "S" && v("QUMO") === "N") ? `.${v("QUCM")}${v("VAECP")}` : "";
        const FORMACONSTRUTIVAVARIADORETIQUETA = v("QUVA") === "S" ? `.${v("QUCM")}${v("VAECP")}` : "";

        const CODIGOVARIADOR = v("QUVA") === "S"
            ? `.${v("VALN")}.${v("VAPT")}${FORMACONSTRUTIVAVARIADOR}.${v("VASCP")}.${v("VAPM")}`
            : "";

        const FORMACONSTRUTIVAADAPTACAO = (v("QUMO") === "N" && v("QUVA") === "N" && v("QUPL") === "S")
            ? `${v("QUCM")}BSV.`
            : "";

        const CODIGOADAPTACAO = v("QUPL") === "S"
            ? `${v("PLDE")}.${v("PLBU")}.${v("PLGU")}.${v("PLFU")}.`
            : "";

        const LINHAPRODUTO = seAlgum(
            v("QUMO") === "N" && v("QUVA") === "N" && v("QUPL") === "N", v("QULN"),
            v("QUMO") === "N" && v("QUVA") === "N" && v("QUPL") === "S", v("QULN"),
            v("QUMO") === "N" && v("QUVA") === "S" && v("QUPL") === "N", v("QULN"),
            v("QUMO") === "S" && v("QUVA") === "N" && v("QUPL") === "N", substituir(v("QULN"), "1.", "M."),
            v("QUMO") === "S" && v("QUVA") === "S" && v("QUPL") === "N", substituir(v("QULN"), "1.", "MV.")
        );

        const COMPOSICAOCODIGO = [
            LINHAPRODUTO,
            TAMANHOREDUTOR,
            v("QURD"),
            v("QURD1"),
            FORMACONSTRUTIVAREDUTOR,
            FORMACONSTRUTIVAADAPTACAO,
            CODIGOADAPTACAO,
            (v("QUCM").includes("EE") || v("QUCP").includes("EE")) ? "" : (vazio(v("QUBU")) ? "N." : `${v("QUBU")}.`),
            vazio(v("QUBU2")) ? "N" : v("QUBU2"),
            UNIAOCARCACAO,
            v("QUAF"),
            POSICAOACESSORIOFIXACAO,
            POSICAOBRACOTORQUE,
            v("QUAS"),
            POSICAOACESSORIOSAIDA,
            CAPADEPROTECAO,
            COORDENADASPADRAO,
            VARIOSOPCIONAISREDUTOR,
            VAZADOREDUTOR,
            CODIGOVARIADOR,
            CODIGOMOTOR
        ]
            .map(s => s.replace(/^\.|\.$/g, ""))
            .map(s => s.replace(/,\s*/g, ".").replace(/\s+/g, ""))
            .map(s => s.replace(/\.{2,}/g, "."))
            .filter(Boolean)
            .join(".");

        document.getElementById("refProduto").textContent = COMPOSICAOCODIGO;
        mostrarDetalhesProduto({}, COMPOSICAOCODIGO);

        fetch("/Paginas/Seletores/Produto/CodigoDescricaoObservacaoProduto.php", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `codigo=${encodeURIComponent(COMPOSICAOCODIGO)}`
        })
            .then(resp => resp.text())
            .then(text => {
                let dados;
                try { dados = JSON.parse(text); } catch { throw new Error(text); }
                return dados;
            })
            .then(dados => {
                mostrarDetalhesProduto(dados || {}, COMPOSICAOCODIGO);
                if (typeof mostrarDetalhesEstoque === 'function') {
                    mostrarDetalhesEstoque(dados?.CD_PRODUTO || "");
                }
            })
            .catch(err => {
                console.error('Erro ao obter dados do produto', err);
                if (typeof exibirAlerta === 'function') {
                    exibirAlerta('⚠️ Erro ao obter dados do produto.');
                }
                mostrarDetalhesProduto({}, COMPOSICAOCODIGO);
                if (typeof mostrarDetalhesEstoque === 'function') {
                    mostrarDetalhesEstoque('');
                }
            });


        if (window.ultimoHistoricoProduto !== COMPOSICAOCODIGO) {
            fetch("/Paginas/AreaCliente/Sessao/Produtos/RegistrarProduto.php", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `produto=${encodeURIComponent(COMPOSICAOCODIGO)}`
            });
            window.ultimoHistoricoProduto = COMPOSICAOCODIGO;
        }
        exibirBotaoCompartilhar();
        exibirBotaoSolicitarDesenho();
        exibirBotaoSolicitarCotacao();
    }

</script>

<script>
    document.addEventListener('click', e => {
        const img = e.target.closest('.popover img');
        if (!img) return;
        e.preventDefault();
        const container = img.closest('.popover-body');
        if (!container) return;
        const imgs = Array.from(container.querySelectorAll('img')).filter(i => i.naturalWidth);
        const index = imgs.indexOf(img);
        const items = imgs.map(i => ({
            src: i.src,
            width: i.naturalWidth || 800,
            height: i.naturalHeight || 600
        }));
        const lb = new PhotoSwipeLightbox({
            dataSource: items,
            pswpModule: PhotoSwipe,
            initialZoomLevel: 1,
            secondaryZoomLevel: 2,
            wheelToZoom: true,
            imageClickAction: 'zoom'
        });
        lb.on('close', () => lb.destroy());
        lb.init();
        lb.loadAndOpen(index);
    });
</script>

</body>

</html>