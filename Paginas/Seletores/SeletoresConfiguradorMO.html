<!DOCTYPE html>

<main id="main-content" class="sr-only">
    <h1>
        Configurador
    </h1>

    <div id="titulo-estrutural">
        Configurador
    </div>
</main>

<link rel="stylesheet" href="/Layout/Galeria/Galeria.min.css">

<main class="main mb-0 pb-0">
    <div class="pagina__titulo--bloco fw-bold mt-5 mb-4">
    </div>
    <div class="container">
        <div class="galeria-produto" data-visible="3.APM" data-folder="IBRAPM" data-title="IBR APM"
            data-description="Os motores elétricos da linha APM oferecem alta tecnologia e eficiência premium (classe IE3), desde os materiais com os quais foi projetado até seu design elegante, foi concebido especialmente para trabalhar em ambientes com grandes exigências de higiene, onde os ciclos e os agentes de limpeza são agressivos."
            data-site="https://www.redutoresibr.com.br/pt/Produtos/motor-apm" data-catalog="">
        </div>

        <div class="galeria-produto" data-visible="3.SPM" data-folder="IBRSPM" data-title="IBR SPM"
            data-description="Os motores elétricos da linha SPM são totalmente construídos com aço inoxidável, permitindo sua aplicação em ambientes que necessitam de grande resistência a corrosão. Seu design sem aletas facilita a limpeza, uma vez que não acumula sujeira, a cuidadosa seleção dos seus materiais, permite que ainda assim opere com baixa temperatura na superfície. A sua eficiência premium (IE3) garante o melhor custo-benefício."
            data-site="https://www.redutoresibr.com.br/pt/Produtos/motor-spm" data-catalog="">
        </div>

        <div class="galeria-produto" data-visible="3.I" data-folder="IBRT3AT3C" data-title="IBR T3A/T3C"
            data-description="A linha de motores elétricos trifásicos T3A e T3C são motores de indução assíncronos de alto rendimento (IR3), fabricados em carcaça de alumínio ou ferro fundido com revestimento de pintura, o que confere leveza, boa dissipação de calor e resistência a corrosão e degradação pelo ambiente. Possui versatilidade na aplicação, uma vez que é possível customizar a posição dos pés de apoio, como também da caixa de ligação e do prensa cabos. Disponível com concepção de 2 a 8 polos."
            data-site="https://www.redutoresibr.com.br/pt/Produtos/motor-ibr-t3a-"
            data-catalog="https://www.redutoresibr.com.br/_uploads/61c76794-8dd9-4a93-92f7-d09a598e799b.pdf">
        </div>

        <div class="galeria-produto" data-visible="2.I" data-folder="IBRMSML" data-title="IBR MS/ML"
            data-description="As linhas de motores elétricos monofásicos ML e trifásicos standard MS são fabricadas com carcaça de alumínio, revestidas com pintura de alta qualidade e possuem múltiplas aletas, o que proporciona leveza, excelente dissipação de calor, além de garantir resistência à corrosão e à degradação pelo ambiente.Ambas as linhas oferecem alta versatilidade na aplicação, permitindo a customização da posição dos pés de apoio, da caixa de ligação e do prensa cabos, adaptando-se facilmente às necessidades de montagem dos clientes.Os motores estão disponíveis com concepção de 4 polos, atendendo a uma ampla gama de aplicações industriais e comerciais."
            data-site="https://www.redutoresibr.com.br/pt/Produtos/motor-ibr-ms-"
            data-catalog="https://www.redutoresibr.com.br/_uploads/f6efd4a9-4ea1-4f1f-a4b8-a9b915667d8e.pdf">
        </div>

        <div class="galeria-produto" data-visible="3.W" data-folder="WEGT3A" data-title="IBR WEG ALTO RENDIMENTO"
            data-description="Motores da linha W22 da marca WEG, fabricados em carcaça de ferro fundido. São ideais para sistemas automatizados, equipamentos industriais e uso contínuo. Possuem registro de objeto do INMETRO na portaria número 290, de 07 de julho de 2021 e recebem a Etiqueta Nacional de Conservação de Energia."
            data-site="https://www.redutoresibr.com.br/pt/Categoria/Linhas/motores"
            data-catalog="https://drive.google.com/file/d/1DwAwh27oSnIE0Rsk7asbgQ-SjrmN9CKg/view?usp=sharing">
        </div>
    </div>
    <div id="titulo-configurador" class="pagina__titulo--bloco mt-5 mb-5 text-center">
        <h2 id="texto-configurador" class="fs-3 fw-bolder m-0"></h2>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        function atualizarTitulo() {
            const visivel = Array.from(document.querySelectorAll('.galeria-produto[data-title]'))
                .find(g => g.style.display !== 'none');
            const titulo = visivel ? visivel.dataset.title : '';
            const el = document.getElementById('texto-configurador');
            if (!el) return;
            if (!titulo) {
                el.innerHTML = '';
                document.title = 'Configurador de Produtos';
                return;
            }
            let html = 'Configure o seu ';
            if (titulo.toUpperCase().startsWith('IBR ')) {
                const partes = titulo.split(' ');
                const primeiro = partes.shift();
                const resto = partes.join(' ');
                html += '<span class="text-dark">' + primeiro + '</span>';
                if (resto) html += ' <span class="text-orange">' + resto + '</span>';
            } else {
                html += titulo;
            }
            el.innerHTML = html;
            document.title = 'Configurador de Produtos - ' + titulo;
        }
        atualizarTitulo();
        setTimeout(atualizarTitulo);
        document.getElementById('MOLN')?.addEventListener('change', atualizarTitulo);
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const helpConfigs = {

            GrupoMOLN() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOTP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOTT() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOFQ() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOPT() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOPL() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOCM() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOCP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOCPP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOPP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOPM() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOOPC() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOCR() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },
        }

        const buttons = document.querySelectorAll('button.help-icon[data-help-text]');
        buttons.forEach(btn => {
            btn.dataset.helpTextOriginal = btn.dataset.helpText;
            btn.dataset.helpTitleOriginal = btn.dataset.helpTitle;
        });

        function updateButton(btn, data) {
            if (!data) {
                data = { title: btn.dataset.helpTitleOriginal, text: btn.dataset.helpTextOriginal };
            }
            btn.dataset.helpTitle = data.title || '';
            btn.dataset.helpText = data.text || '';
            btn.dataset.bsTitle = data.title || '';
            btn.dataset.bsContent = data.text || '';
            const pop = bootstrap.Popover.getOrCreateInstance(btn);
            pop.setContent({ '.popover-header': data.title || '', '.popover-body': data.text || '' });
        }

        function updateHelps() {
            buttons.forEach(btn => {
                const section = btn.closest('section');
                const cfgFn = section && helpConfigs[section.id];
                const data = cfgFn && cfgFn();
                updateButton(btn, data);
            });
        }

        ['MOLN', 'MOTP', 'MOTT', 'MOFQ', 'MOPT', 'MOPL', 'MOCM', 'MOCP', 'MOCPP', 'MOPP', 'MOPM', 'MOOPC', 'MOCR'].forEach(id => {
            document.getElementById(id)?.addEventListener('change', updateHelps);
        });

        updateHelps();
    });
</script>

<script src="/Layout/Galeria/Galeria.min.js"></script>
<script src="/Layout/Galeria/FiltrarPorURL.min.js"></script>

<section id="GrupoMOLN">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOLN">Linha do Motor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="MOLN" name="MOLN">
    </select>
</section>

<section id="GrupoMOTP">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOTP">Tipo do Motor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="MOTP" name="MOTP">
    </select>
</section>


<section id="GrupoMOTT">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOTT">Tensão do Motor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="MOTT" name="MOTT">
    </select>
</section>


<section id="GrupoMOFQ">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOFQ">Frequência do Motor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="MOFQ" name="MOFQ">
    </select>
</section>


<section id="GrupoMOPT">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOPT">Potência do Motor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="MOPT" name="MOPT">
    </select>
</section>


<section id="GrupoMOPL">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOPL">Polaridade do Motor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="MOPL" name="MOPL">
    </select>
</section>


<section id="GrupoMOCM">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOCM">Carcaça do Motor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="MOCM" name="MOCM">
    </select>
</section>


<section id="GrupoMOCP" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOCP">Forma Construtiva do Motor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="MOCP" name="MOCP">

    </select>


    <div class="SubgrupoMOCP" style="display: none;">
        <section id="GrupoMOCPP" class="subgrupo subgrupo-aninhado grupo-condicional">
            <label class="cssB" for="MOCPP">Posição dos Pés do Motor:</label>
            <select class="cssC" id="MOCPP" name="MOCPP">

            </select>
        </section>
    </div>
</section>


<section id="GrupoMOPP" class="grupo-condicional" style="display: none;">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOPP">Posição do Prensa Cabo:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="MOPP" name="MOPP">

    </select>
</section>


<section id="GrupoMOPM" class="grupo-condicional" style="display: none;">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOPM">Posição de Montagem do Motor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="MOPM" name="MOPM">
    </select>
</section>


<section id="GrupoMOOPC" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOOPC_NAO">Itens Opcionais do Motor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <div id="dropdownMOOPC" class="dropdown-checkbox" style="max-width:400px; margin: 0 auto;">
        <div class="dropdown-button cssC" onclick="toggleDropdown(this)">NÃO</div>
        <div class="dropdown-list"
            style="display:none; border: 1px solid #ec4115; max-height: 180px; overflow-y: auto; border-radius: 6px; background: white; padding: 10px; margin-top: 4px;">
            <div id="checklistMOOPC" style="display:flex; flex-direction:column; gap:6px; text-align:left;">
                <label><input type="checkbox" id="MOOPC_NAO" name="MOOPC" value="NÃO" checked> NÃO</label>
                <label><input type="checkbox" name="MOOPC" value="ACOR"> PINTURA ANTICORROSIVA</label>
                <label><input type="checkbox" name="MOOPC" value="PINTCZ"> PINTURA CINZA</label>
                <label><input type="checkbox" name="MOOPC" value="VF"> VENTILAÇÃO FORÇADA</label>
                <label><input type="checkbox" name="MOOPC" value="CR"> CONTRA RECUO</label>
            </div>
        </div>
        <input type="hidden" id="MOOPC" name="MOOPC" value="NÃO">
    </div>


    <div class="SubgrupoMOOPC" style="display: none;">
        <section id="GrupoMOCR" class="subgrupo subgrupo-aninhado grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOCR">Sentido de Giro do
                Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOCR" name="MOCR">
                <option value="H">HORÁRIO</option>
                <option value="AH">ANTI-HORÁRIO</option>
            </select>
        </section>
    </div>
</section>


</div>
</section>

<script>

    async function carregarMOLN() {
        const grupoMOLN = document.getElementById('GrupoMOLN');
        const molnSelect = document.getElementById('MOLN');

        const response = await fetch(`/Paginas/Seletores/Configuradores/MO/MOLN.php`);
        const optionsHTML = await response.text();
        molnSelect.innerHTML = optionsHTML;

        molnSelect.style.display = 'block';
        molnSelect.dispatchEvent(new Event('change'));

        molnSelect.value = '';

        carregarMOTP();
        carregarMOOPC();

        molnSelect.addEventListener('change', carregarMOTP);
        molnSelect.addEventListener('change', carregarMOOPC);
    }

    async function carregarMOTP() {
        const moln = document.getElementById('MOLN')?.value;
        const grupoMOTP = document.getElementById('GrupoMOTP');
        const motpSelect = document.getElementById('MOTP');

        const response = await fetch(`/Paginas/Seletores/Configuradores/MO/MOTP.php?MOLN=${encodeURIComponent(moln)}`);
        const optionsHTML = await response.text();
        motpSelect.innerHTML = optionsHTML;

        grupoMOTP.style.display = 'block';
        motpSelect.style.display = 'block';
        motpSelect.value = '';

        carregarMOTT();
    }

    async function carregarMOTT() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const grupoMOTT = document.getElementById('GrupoMOTT');
        const mottSelect = document.getElementById('MOTT');

        const response = await fetch(`/Paginas/Seletores/Configuradores/MO/MOTT.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}`);
        const optionsHTML = await response.text();
        mottSelect.innerHTML = optionsHTML;

        grupoMOTT.style.display = 'block';
        mottSelect.style.display = 'block';
        mottSelect.value = '';

        carregarMOFQ();
    }

    async function carregarMOFQ() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const grupoMOFQ = document.getElementById('GrupoMOFQ');
        const mofqSelect = document.getElementById('MOFQ');

        const response = await fetch(`/Paginas/Seletores/Configuradores/MO/MOFQ.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}`);
        const optionsHTML = await response.text();
        mofqSelect.innerHTML = optionsHTML;

        grupoMOFQ.style.display = 'block';
        mofqSelect.style.display = 'block';
        mofqSelect.value = '';

        carregarMOPT();
    }

    async function carregarMOPT() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const mofq = document.getElementById('MOFQ')?.value;
        const grupoMOPT = document.getElementById('GrupoMOPT');
        const moptSelect = document.getElementById('MOPT');

        const response = await fetch(`/Paginas/Seletores/Configuradores/MO/MOPT.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}&MOFQ=${encodeURIComponent(mofq)}`);
        const optionsHTML = await response.text();
        moptSelect.innerHTML = optionsHTML;

        grupoMOPT.style.display = 'block';
        moptSelect.style.display = 'block';
        moptSelect.value = '';

        carregarMOPL();
    }

    async function carregarMOPL() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const mofq = document.getElementById('MOFQ')?.value;
        const mopt = document.getElementById('MOPT')?.value;
        const grupoMOPL = document.getElementById('GrupoMOPL');
        const moplSelect = document.getElementById('MOPL');

        const response = await fetch(`/Paginas/Seletores/Configuradores/MO/MOPL.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}&MOFQ=${encodeURIComponent(mofq)}&MOPT=${encodeURIComponent(mopt)}`);
        const optionsHTML = await response.text();
        moplSelect.innerHTML = optionsHTML;

        grupoMOPL.style.display = 'block';
        moplSelect.style.display = 'block';
        moplSelect.value = '';

        carregarMOCM();
    }

    async function carregarMOCM() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const mofq = document.getElementById('MOFQ')?.value;
        const mopt = document.getElementById('MOPT')?.value;
        const mopl = document.getElementById('MOPL')?.value;
        const grupoMOCM = document.getElementById('GrupoMOCM');
        const mocmSelect = document.getElementById('MOCM');

        const response = await fetch(`/Paginas/Seletores/Configuradores/MO/MOCM.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}&MOFQ=${encodeURIComponent(mofq)}&MOPT=${encodeURIComponent(mopt)}&MOPL=${encodeURIComponent(mopl)}`);
        const optionsHTML = await response.text();
        mocmSelect.innerHTML = optionsHTML;

        grupoMOCM.style.display = 'block';
        mocmSelect.style.display = 'block';

        carregarMOCP();
    }

    async function carregarMOCP() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const mofq = document.getElementById('MOFQ')?.value;
        const mopt = document.getElementById('MOPT')?.value;
        const mopl = document.getElementById('MOPL')?.value;
        const mocm = document.getElementById('MOCM')?.value;
        const mocp = document.getElementById('MOCP')?.value;
        const grupoMOCP = document.getElementById('GrupoMOCP');
        const mocpSelect = document.getElementById('MOCP');

        const response = await fetch(`/Paginas/Seletores/Configuradores/MO/MOCP.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}&MOFQ=${encodeURIComponent(mofq)}&MOPT=${encodeURIComponent(mopt)}&MOPL=${encodeURIComponent(mopl)}&MOCM=${encodeURIComponent(mocm)}&MOCP=${encodeURIComponent(mocp)}`);
        const optionsHTML = await response.text();
        mocpSelect.innerHTML = optionsHTML;

        grupoMOCP.style.display = 'block';
        mocpSelect.style.display = 'block';
        mocpSelect.value = mocp;
        mocpSelect.dispatchEvent(new Event('change'));

        carregarMOCPP();
    }

    function carregarMOCPP() {
        const moln = document.getElementById('MOLN')?.value;
        const mocp = document.getElementById('MOCP')?.value;
        const mocm = document.getElementById('MOCM')?.value;
        const grupoMOCPP = document.getElementById('GrupoMOCPP');
        const divSubgrupo = document.querySelector('.SubgrupoMOCP');
        const mocppSelect = document.getElementById('MOCPP');

        const deveExibir = moln !== "3.W" && ["B3", "B34", "B35"].includes(mocp);

        if (deveExibir) {
            mocppSelect.innerHTML = '';
            mocppSelect.innerHTML += '<option value="T" selected>Topo</option>';

            const bloqueado = moln === "2.I" && mocm === "56";
            if (!bloqueado) {
                mocppSelect.innerHTML += '<option value="D">Direita</option>';
                mocppSelect.innerHTML += '<option value="E">Esquerda</option>';
            }

            divSubgrupo.style.display = 'block';
            grupoMOCPP.style.display = 'block';
        } else {
            divSubgrupo.style.display = 'none';
            grupoMOCPP.style.display = 'none';
        }

        if (["3.APM", "3.SPM"].includes(moln)) {
            carregarMOPM();
        } else {
            carregarMOPP();
        }
    }

    function carregarMOPP() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mocp = document.getElementById('MOCP')?.value;
        const grupoMOPP = document.getElementById('GrupoMOPP');
        const moppSelect = document.getElementById('MOPP');
        const grupoMOPM = document.getElementById('GrupoMOPM');

        grupoMOPM.style.display = 'none';

        moppSelect.innerHTML = '';

        let valorPadrao = '';

        if (moln === "3.I" || (moln === "2.I" && motp === "T")) {
            valorPadrao = "PC1";
        } else if (moln === "2.I" && motp === "M") {
            valorPadrao = "PC2";
        } else if (moln === "3.W") {
            valorPadrao = "PC3";
        }

        const deveOcultar = motp === "M" && ["B5", "B35"].includes(mocp);

        moppSelect.innerHTML += `<option value="PC1">1</option>`;
        moppSelect.innerHTML += `<option value="PC2">2</option>`;
        moppSelect.innerHTML += `<option value="PC3">3</option>`;
        moppSelect.innerHTML += `<option value="PC4">4</option>`;

        if (deveOcultar && ["PC1", "PC3", "PC4"].includes(valorPadrao)) {
            valorPadrao = "";
        }

        grupoMOPP.style.display = 'block';
        moppSelect.style.display = 'block';
        moppSelect.value = valorPadrao;

        carregarMOOPC();
        validarMOOPC();
    }

    function carregarMOPM() {
        const grupoMOPM = document.getElementById('GrupoMOPM');
        const mopmSelect = document.getElementById('MOPM');
        const grupoMOPP = document.getElementById('GrupoMOPP');

        grupoMOPP.style.display = 'none';

        mopmSelect.innerHTML = '';
        mopmSelect.innerHTML += `<option value="B3" selected>B3</option>`;
        mopmSelect.innerHTML += `<option value="B5">B5</option>`;
        mopmSelect.innerHTML += `<option value="B6">B6</option>`;
        mopmSelect.innerHTML += `<option value="B7">B7</option>`;
        mopmSelect.innerHTML += `<option value="B8">B8</option>`;
        mopmSelect.innerHTML += `<option value="V5">V5</option>`;
        mopmSelect.innerHTML += `<option value="V6">V6</option>`;

        grupoMOPM.style.display = 'block';
        mopmSelect.style.display = 'block';
        mopmSelect.value = "B3";

        carregarMOOPC();
        validarMOOPC();
    }

    function carregarMOOPC() {
        const moln = document.getElementById('MOLN')?.value.trim();
        const mocm = document.getElementById('MOCM')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const grupoMOPP = document.getElementById('GrupoMOPP');
        const grupoMOOPC = document.getElementById('GrupoMOOPC');
        const checklist = document.querySelectorAll('#checklistMOOPC input[type="checkbox"]');

        const grupoMOPM = document.getElementById('GrupoMOPM');

        if ((!grupoMOPP || grupoMOPP.style.display !== 'block') &&
            (!grupoMOPM || grupoMOPM.style.display !== 'block') ||
            !grupoMOOPC) {
            grupoMOOPC.style.display = 'none';
            return;
        }

        grupoMOOPC.style.display = 'block';

        checklist.forEach(cb => {
            const value = cb.value;
            let mostrar = true;

            if (["ACOR", "PINTCZ"].includes(value) && (moln === "3.APM" || moln === "3.SPM")) {
                mostrar = false;
            }

            if (value === "VF") {
                mostrar = (moln === "2.I" && ["63", "71"].includes(mocm)) ||
                    (moln === "3.I" && motp !== "F" && ["63", "71", "80", "90", "100", "112", "132"].includes(mocm));
            }

            if (value === "CR") {
                mostrar = (moln === "3.W" && ["80", "90", "100", "112", "132"].includes(mocm)) ||
                    (moln === "3.I" && ["80", "90", "100", "112"].includes(mocm));
            }

            cb.closest('label').style.display = mostrar ? 'block' : 'none';

            if (!mostrar) cb.checked = false;
        });

        validarMOOPC();
        carregarMOCR();
    }

    const moopcSelect = document.getElementById('MOOPC');
    if (moopcSelect) {
        moopcSelect.addEventListener('change', carregarMOCR);
        moopcSelect.addEventListener('change', validarMOOPC);
    }

    function validarMOOPC() {
        const checkboxes = document.querySelectorAll('#checklistMOOPC input[type="checkbox"]');
        let selecionados = Array.from(checkboxes)
            .filter(cb => cb.checked)
            .map(cb => cb.value);

        if (selecionados.includes("NÃO") && selecionados.length > 1) {
            document.querySelector('input[name="MOOPC"][value="NÃO"]').checked = false;
            selecionados = selecionados.filter(v => v !== "NÃO");
        }

        if (selecionados.length === 0) {
            document.querySelector('input[name="MOOPC"][value="NÃO"]').checked = true;
            selecionados = ["NÃO"];
        }

        if (selecionados.includes("ACOR") && selecionados.includes("PINTCZ")) {
            document.querySelector('input[name="MOOPC"][value="ACOR"]').checked = false;
            selecionados = selecionados.filter(v => v !== "ACOR");
        }

        document.getElementById('MOOPC').value = selecionados.join(',');

        const nomesVisiveis = selecionados.map(valor => {
            const label = Array.from(document.querySelectorAll('#checklistMOOPC label')).find(lbl =>
                lbl.querySelector(`input[value="${valor}"]`)
            );
            return label ? label.textContent.trim() : valor;
        });

        document.querySelector('#dropdownMOOPC .dropdown-button').textContent = nomesVisiveis.join(', ');

        carregarMOCR();
    }

    document.getElementById('MOOPC').dispatchEvent(new Event('change'));

    document.addEventListener('DOMContentLoaded', () => {
        const checkboxes = document.querySelectorAll('#checklistMOOPC input[type="checkbox"]');
        checkboxes.forEach(cb => {
            cb.addEventListener('change', validarMOOPC);
        });
    });

    function carregarMOCR() {
        const grupoMOCR = document.getElementById('GrupoMOCR');
        const grupoQUCR = document.getElementById('GrupoQUCR');
        const subgrupoMOOPC = document.querySelector('.SubgrupoMOOPC');
        const mocrSelect = document.getElementById('MOCR');
        const moopc = document.getElementById('MOOPC')?.value || '';

        const crSelecionado = moopc.split(',').includes('CR');

        if (!crSelecionado) {
            if (subgrupoMOOPC) subgrupoMOOPC.style.display = 'none';
            if (grupoMOCR) grupoMOCR.style.display = 'none';
            if (grupoQUCR) grupoQUCR.style.display = 'none';
            if (mocrSelect) mocrSelect.value = '';
            return;
        }

        if (subgrupoMOOPC) subgrupoMOOPC.style.display = 'block';
        if (grupoMOCR) grupoMOCR.style.display = 'block';
        if (grupoQUCR) grupoQUCR.style.display = 'none';

        if (mocrSelect) {
            mocrSelect.innerHTML = `
            <option value="H">HORÁRIO</option>
            <option value="AH">ANTI-HORÁRIO</option>
        `;
            mocrSelect.value = '';
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        carregarMOLN();

        const dropdownButton = document.querySelector('#dropdownMOOPC .dropdown-button');
        const dropdownList = document.querySelector('#dropdownMOOPC .dropdown-list');

        document.querySelectorAll('#checklistMOOPC input[type="checkbox"]').forEach(cb => {
            cb.addEventListener('change', validarMOOPC);
        });

        window.toggleDropdown = function (button) {
            const list = button.nextElementSibling;
            list.style.display = list.style.display === 'block' ? 'none' : 'block';
        };

        document.addEventListener('click', function (e) {
            document.querySelectorAll('.dropdown-checkbox').forEach(dropdown => {
                if (!dropdown.contains(e.target)) {
                    dropdown.querySelector('.dropdown-list').style.display = 'none';
                }
            });
        });

        document.getElementById('MOLN')?.addEventListener('change', carregarMOTP);
        document.getElementById('MOTP')?.addEventListener('change', carregarMOTT);
        document.getElementById('MOTT')?.addEventListener('change', carregarMOFQ);
        document.getElementById('MOFQ')?.addEventListener('change', carregarMOPT);
        document.getElementById('MOPT')?.addEventListener('change', carregarMOPL);
        document.getElementById('MOPL')?.addEventListener('change', carregarMOCM);
        document.getElementById('MOCM')?.addEventListener('change', carregarMOCP);
        document.getElementById('MOCP')?.addEventListener('change', carregarMOCPP);
    });


</script>

<script>
    function exibirBotaoCompartilhar() {
        const wrapper = document.getElementById("compartilhar-wrapper");
        if (wrapper) wrapper.style.display = "block";
        if (typeof exibirBotaoRefazerConfiguracao === "function") exibirBotaoRefazerConfiguracao();
    }

    function exibirBotaoSolicitarDesenho() {
        document.getElementById("solicitar-wrapper").style.display = "inline-flex";
    }

    function exibirBotaoSolicitarCotacao() {
        const wrapper = document.getElementById("cotacao-wrapper");
        if (wrapper) wrapper.style.display = "block";
    }

    async function gerarCodigoProduto() {
        const MOLN = v("MOLN");
        const MOTP = v("MOTP");
        const MOTT = v("MOTT");
        const MOFQ = v("MOFQ");
        const MOPT = v("MOPT");
        const MOPL = v("MOPL");
        const MOCM = v("MOCM");
        const MOCP = v("MOCP");
        const MOCPP = v("MOCPP");
        const MOOPC = v("MOOPC");
        const MOCR = v("MOCR");
        const MOPP = v("MOPP");
        const MOPM = v("MOPM");

        const params = new URLSearchParams({
            MOLN, MOTP, MOTT, MOFQ, MOPT, MOPL, MOCM
        }).toString();

        const CARCACAINICIO = await fetch(`/Paginas/Seletores/Produto/CARCACAINICIO.php?${params}`)
            .then(r => r.ok ? r.text() : "")
            .then(t => t.trim());

        const CARCACAFIM = await fetch(`/Paginas/Seletores/Produto/CARCACAFIM.php?${params}`)
            .then(r => r.ok ? r.text() : "")
            .then(t => t.trim());

        const CARCACA = `${CARCACAINICIO}${MOCM}${CARCACAFIM}`;

        const PES = MOLN !== "3.W" && ["B3", "B34", "B35"].includes(MOCP) ? MOCPP : "";

        let TEMOPCIONAIS = (MOOPC === "NÃO" || vazio(MOOPC)) ? "" : `.${MOOPC}`;
        let VARIOSOPCIONAIS = TEMOPCIONAIS.includes(",") ? TEMOPCIONAIS.replaceAll(", ", ".") : TEMOPCIONAIS;

        let OPCIONAISPADRAO = VARIOSOPCIONAIS.includes("CR") ? `${VARIOSOPCIONAIS}${MOCR}` : VARIOSOPCIONAIS;

        let PRENSACABO = "";

        const condicaoExcluir = (
            MOLN === "3.APM" ||
            MOLN === "3.SPM" ||
            (MOLN === "3.I" && MOPP === "PC1") ||
            (MOLN === "2.I" && MOTP === "T" && MOPP === "PC1") ||
            (MOLN === "2.I" && MOTP === "M" && MOPP === "PC2") ||
            (MOLN === "3.W" && MOPP === "PC3")
        );

        if (!condicaoExcluir && !vazio(MOPP)) {
            PRENSACABO = `.${MOPP}`;
        }


        const POSICAOMOTOR = ["3.APM", "3.SPM"].includes(MOLN) ? `.${MOPM}` : "";

        const COMPOSICAOCODIGO = [
            MOLN,
            MOTP,
            MOTT,
            MOPT,
            MOPL,
            `${CARCACA}${MOCP}${PES}`,
            MOFQ,
            OPCIONAISPADRAO,
            POSICAOMOTOR,
            PRENSACABO
        ]
            .map(s => s.replace(/^\.|\.$/g, ""))
            .map(s => s.replace(/,\s*/g, ".").replace(/\s+/g, ""))
            .map(s => s.replace(/\.{2,}/g, "."))
            .filter(Boolean)
            .join(".");

        document.getElementById("refProduto").textContent = COMPOSICAOCODIGO;
        mostrarDetalhesProduto({}, COMPOSICAOCODIGO);

        fetch("/Paginas/Seletores/Produto/CodigoDescricaoObservacaoProduto.php", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `codigo=${encodeURIComponent(COMPOSICAOCODIGO)}`
        })
            .then(resp => resp.text())
            .then(text => {
                let dados;
                try { dados = JSON.parse(text); } catch { throw new Error(text); }
                return dados;
            })
            .then(dados => {
                mostrarDetalhesProduto(dados || {}, COMPOSICAOCODIGO);
                if (typeof mostrarDetalhesEstoque === 'function') {
                    mostrarDetalhesEstoque(dados?.CD_PRODUTO || "");
                }
            })
            .catch(err => {
                console.error('Erro ao obter dados do produto', err);
                if (typeof exibirAlerta === 'function') {
                    exibirAlerta('⚠️ Erro ao obter dados do produto.');
                }
                mostrarDetalhesProduto({}, COMPOSICAOCODIGO);
                if (typeof mostrarDetalhesEstoque === 'function') {
                    mostrarDetalhesEstoque('');
                }
            });


        if (window.ultimoHistoricoProduto !== COMPOSICAOCODIGO) {
            fetch("/Paginas/AreaCliente/Sessao/Produtos/RegistrarProduto.php", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `produto=${encodeURIComponent(COMPOSICAOCODIGO)}`
            });
            window.ultimoHistoricoProduto = COMPOSICAOCODIGO;
        }

        exibirBotaoCompartilhar();
        exibirBotaoSolicitarDesenho();
        exibirBotaoSolicitarCotacao();
    }
</script>

<script>
    document.addEventListener('click', e => {
        const img = e.target.closest('.popover img');
        if (!img) return;
        e.preventDefault();
        const container = img.closest('.popover-body');
        if (!container) return;
        const imgs = Array.from(container.querySelectorAll('img')).filter(i => i.naturalWidth);
        const index = imgs.indexOf(img);
        const items = imgs.map(i => ({
            src: i.src,
            width: i.naturalWidth || 800,
            height: i.naturalHeight || 600
        }));
        const lb = new PhotoSwipeLightbox({
            dataSource: items,
            pswpModule: PhotoSwipe,
            initialZoomLevel: 1,
            secondaryZoomLevel: 2,
            wheelToZoom: true,
            imageClickAction: 'zoom'
        });
        lb.on('close', () => lb.destroy());
        lb.init();
        lb.loadAndOpen(index);
    });
</script>

</body>

</html>