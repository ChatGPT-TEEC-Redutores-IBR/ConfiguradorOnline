<!DOCTYPE html>

<main id="main-content" class="sr-only">
    <h1>
        Configurador
    </h1>

    <div id="titulo-estrutural">
        Configurador
    </div>
</main>

<link rel="stylesheet" href="/Layout/Galeria/Galeria.min.css">

<main class="main mb-0 pb-0">
    <div class="pagina__titulo--bloco fw-bold mt-5 mb-4">
    </div>
    <div class="container">
        <div class="galeria-produto" data-visible="1.V" data-folder="IBRV" data-title="IBR Variador Mecânico"
            data-description="Fabricadas em carcaça de alumínio, a linha de variadores mecânicos da IBR possibilitam a variação da velocidade de rotação de saída através de um controle manual. Através de flanges no padrão FF, eles são facilmente acoplados na entrada à motores elétricos padrão e na saída podem ser diretamente utilizados em máquinas ou acoplados a entrada de redutores, conforme a necessidade da aplicação desejada."
            data-site="https://www.redutoresibr.com.br/pt/Produtos/variador-mecanico"
            data-catalog="https://www.redutoresibr.com.br/_uploads/841f3577-cbc8-46ad-b66d-ffa7e1143052.pdf">
        </div>
    </div>
    <div id="titulo-configurador" class="pagina__titulo--bloco mt-5 mb-5 text-center">
        <h2 id="texto-configurador" class="fs-3 fw-bolder m-0"></h2>
    </div>
</main>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        function atualizarTitulo() {
            const visivel = Array.from(document.querySelectorAll('.galeria-produto[data-title]'))
                .find(g => g.style.display !== 'none');
            const titulo = visivel ? visivel.dataset.title : '';
            const el = document.getElementById('texto-configurador');
            if (!el) return;
            if (!titulo) {
                el.innerHTML = '';
                document.title = 'Configurador de Produtos';
                return;
            }
            let html = 'Configure o seu ';
            if (titulo.toUpperCase().startsWith('IBR ')) {
                const partes = titulo.split(' ');
                const primeiro = partes.shift();
                const resto = partes.join(' ');
                html += '<span class="text-dark">' + primeiro + '</span>';
                if (resto) html += ' <span class="text-orange">' + resto + '</span>';
            } else {
                html += titulo;
            }
            el.innerHTML = html;
            document.title = 'Configurador de Produtos - ' + titulo;
        }
        atualizarTitulo();
        setTimeout(atualizarTitulo);
        document.getElementById('VALN')?.addEventListener('change', atualizarTitulo);
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const helpConfigs = {

            GrupoVALN() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoVAPT() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoVACM() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoVAECP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoVASCP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoVAPM() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoVAMO() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOLN() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOTP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOTT() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOFQ() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOPT() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOPL() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOCP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOCPP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOPC() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOPP() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOOPC() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoMOCR() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },

            GrupoVACR() {
                return {
                    title: 'Em Desenvolvimento',
                    text: `<p>Em Desenvolvimento`
                };
            },
        }

        const buttons = document.querySelectorAll('button.help-icon[data-help-text]');
        buttons.forEach(btn => {
            btn.dataset.helpTextOriginal = btn.dataset.helpText;
            btn.dataset.helpTitleOriginal = btn.dataset.helpTitle;
        });

        function updateButton(btn, data) {
            if (!data) {
                data = { title: btn.dataset.helpTitleOriginal, text: btn.dataset.helpTextOriginal };
            }
            btn.dataset.helpTitle = data.title || '';
            btn.dataset.helpText = data.text || '';
            btn.dataset.bsTitle = data.title || '';
            btn.dataset.bsContent = data.text || '';
            const pop = bootstrap.Popover.getOrCreateInstance(btn);
            pop.setContent({ '.popover-header': data.title || '', '.popover-body': data.text || '' });
        }

        function updateHelps() {
            buttons.forEach(btn => {
                const section = btn.closest('section');
                const cfgFn = section && helpConfigs[section.id];
                const data = cfgFn && cfgFn();
                updateButton(btn, data);
            });
        }

        ['VALN', 'VAPT', 'VACM', 'VAECP', 'VASCP', 'VAPM', 'VAMO', 'MOLN', 'MOTP', 'MOTT', 'MOFQ', 'MOPT', 'MOPL', 'MOCP', 'MOCPP', 'MOPC', 'MOPP', 'MOOPC', 'MOCR', 'VACR'].forEach(id => {
            document.getElementById(id)?.addEventListener('change', updateHelps);
        });

        updateHelps();
    });
</script>

<script src="/Layout/Galeria/Galeria.min.js"></script>
<script src="/Layout/Galeria/FiltrarPorURL.min.js"></script>

<section id="GrupoVALN" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VALN">Linha do Variador:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="VALN" name="VALN">

    </select>
</section>


<section id="GrupoVAPT" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VAPT">Potência do Variador:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="VAPT" name="VAPT">

    </select>
</section>


<section id="GrupoVACM" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VACM">Tamanho da Carcaça do
        Variador:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="VACM" name="VACM">

    </select>
</section>


<section id="GrupoVAECP" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VAECP">Forma Construtiva da Entrada
        do Variador:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="VAECP" name="VAECP">
        <option value="B5">B5</option>
    </select>


    <div class="subgrupo subgrupo-aninhado">
        <section id="GrupoVASCP" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VASCP">Forma Construtiva da
                Saída do Variador:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="VASCP" name="VASCP">

            </select>
        </section>
    </div>
</section>


<section id="GrupoVAPM" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VAPM">Posição de Montagem do
        Variador:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="VAPM" name="VAPM">
        <option value="B3">B3</option>
        <option value="B5">B5</option>
        <option value="V6">V6</option>
    </select>
</section>


<section id="GrupoVAMO" class="grupo-condicional">
    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VAMO">Com Motor:
        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover" data-bs-title=""
            data-bs-content=""></button>
    </label>
    <select class="cssC" id="VAMO" name="VAMO">
        <option value="N">NÃO</option>
        <option value="S">SIM</option>
    </select>


    <div class="subgrupo" style="display: none;">

        <section id="GrupoMOLN" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOLN">Linha do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOLN" name="MOLN">

            </select>
        </section>


        <section id="GrupoMOTP" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOTP">Tipo do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOTP" name="MOTP">

            </select>
        </section>


        <section id="GrupoMOTT" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOTT">Tensão do
                Motor:<button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOTT" name="MOTT">

            </select>
        </section>


        <section id="GrupoMOFQ" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOFQ">Frequência do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOFQ" name="MOFQ">

            </select>
        </section>


        <section id="GrupoMOPT" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOPT">Potência do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOPT" name="MOPT">

            </select>
        </section>


        <section id="GrupoMOPL" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOPL">Polaridade do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOPL" name="MOPL">

            </select>
        </section>


        <section id="GrupoMOCP" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOCP">Forma Construtiva do
                Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOCP" name="MOCP">

            </select>


            <div class="SubgrupoMOCP" style="display: none;">
                <section id="GrupoMOCPP" class="subgrupo subgrupo-aninhado grupo-condicional">
                    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOCPP">Posição dos
                        Pés do Motor:
                        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                            data-bs-title="" data-bs-content=""></button>
                    </label>
                    <select class="cssC" id="MOCPP" name="MOCPP">

                    </select>
                </section>
            </div>
        </section>


        <section id="GrupoMOPC" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOPC">Posição da Caixa de
                Ligação ou de Montagem do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOPC" name="MOPC">

            </select>
        </section>


        <section id="GrupoMOPP" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOPP">Posição do Prensa
                Cabo:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <select class="cssC" id="MOPP" name="MOPP">

            </select>
        </section>


        <section id="GrupoMOOPC" class="grupo-condicional">
            <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOOPC_NAO">Itens Opcionais
                do Motor:
                <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                    data-bs-title="" data-bs-content=""></button>
            </label>
            <div id="dropdownMOOPC" class="dropdown-checkbox" style="max-width:400px; margin: 0 auto;">
                <div class="dropdown-button cssC" onclick="toggleDropdown(this)">NÃO</div>
                <div class="dropdown-list"
                    style="display:none; border: 1px solid #ec4115; max-height: 180px; overflow-y: auto; border-radius: 6px; background: white; padding: 10px; margin-top: 4px;">
                    <div id="checklistMOOPC" style="display:flex; flex-direction:column; gap:6px; text-align:left;">
                        <label><input type="checkbox" id="MOOPC_NAO" name="MOOPC" value="NÃO" checked> NÃO</label>
                        <label><input type="checkbox" name="MOOPC" value="ACOR"> PINTURA ANTICORROSIVA</label>
                        <label><input type="checkbox" name="MOOPC" value="PINTCZ"> PINTURA CINZA</label>
                        <label><input type="checkbox" name="MOOPC" value="VF"> VENTILAÇÃO FORÇADA</label>
                        <label><input type="checkbox" name="MOOPC" value="CR"> CONTRA RECUO</label>
                    </div>
                </div>
                <input type="hidden" id="MOOPC" name="MOOPC" value="NÃO">
            </div>

            <div class="SubgrupoMOOPC" style="display: none;">
                <section id="GrupoMOCR" class="subgrupo subgrupo-aninhado grupo-condicional">
                    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="MOCR">Sentido de
                        Giro do Motor:
                        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                            data-bs-title="" data-bs-content=""></button>
                    </label>
                    <select class="cssC" id="MOCR" name="MOCR">
                        <option value="H">HORÁRIO</option>
                        <option value="AH">ANTI-HORÁRIO</option>
                    </select>
                </section>


                <section id="GrupoVACR" class="subgrupo subgrupo-aninhado grupo-condicional">
                    <label class="cssB d-flex align-items-center gap-1 justify-content-center" for="VACR">Sentido de
                        Giro do Variador:
                        <button class="help-icon" data-help-title="" data-help-text="" data-help-class="perm-popover"
                            data-bs-title="" data-bs-content=""></button>
                    </label>
                    <select class="cssC" id="VACR" name="VACR">

                    </select>
                </section>
            </div>
        </section>
    </div>
</section>

</div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        carregarVALN();
    });

    async function carregarVALN() {
        const grupoVALN = document.getElementById('GrupoVALN');
        const valnSelect = document.getElementById('VALN');

        grupoVALN.style.display = 'block';

        const response = await fetch(`/Paginas/Seletores/Configuradores/VA/VALN.php`);
        const optionsHTML = await response.text();
        valnSelect.innerHTML = optionsHTML;
        valnSelect.style.display = 'block';
        valnSelect.disabled = false;
        valnSelect.value = '1.V';
        valnSelect.dispatchEvent(new Event('change'));
    }

    document.getElementById('VALN')?.addEventListener('change', carregarVAPT);

    async function carregarVAPT() {
        const valn = document.getElementById('VALN')?.value;
        const grupoVAPT = document.getElementById('GrupoVAPT');
        const vaptSelect = document.getElementById('VAPT');

        grupoVAPT.style.display = 'block';

        const response = await fetch(`/Paginas/Seletores/Configuradores/VA/VAPT.php?VALN=${encodeURIComponent(valn)}`);
        const optionsHTML = await response.text();
        vaptSelect.innerHTML = optionsHTML;
        vaptSelect.disabled = false;
        vaptSelect.style.display = 'block';
        vaptSelect.value = '';
        vaptSelect.dispatchEvent(new Event('change'));
    }

    document.getElementById('VAPT')?.addEventListener('change', () => {
        carregarVACM();
        carregarVAECP();
    });

    async function carregarVACM() {
        const valn = document.getElementById('VALN')?.value;
        const vapt = document.getElementById('VAPT')?.value;
        const grupoVACM = document.getElementById('GrupoVACM');
        const vacmSelect = document.getElementById('VACM');

        grupoVACM.style.display = 'block';

        const response = await fetch(`/Paginas/Seletores/Configuradores/VA/VACM.php?VALN=${encodeURIComponent(valn)}&VAPT=${encodeURIComponent(vapt)}`);
        const optionsHTML = await response.text();
        vacmSelect.innerHTML = optionsHTML;
        vacmSelect.disabled = false;
        vacmSelect.style.display = 'block';
        vacmSelect.dispatchEvent(new Event('change'));

        carregarVAMO();
        carregarVAECP();
        carregarVASCP();
    }

    document.getElementById('VACM')?.addEventListener('change', carregarVAECP);
    document.getElementById('VACM')?.addEventListener('change', carregarVASCP);

    function carregarVAECP() {
        const grupoVAECP = document.getElementById('GrupoVAECP');
        const vaecpSelect = document.getElementById('VAECP');

        grupoVAECP.style.display = 'block';
        vaecpSelect.disabled = false;
        vaecpSelect.value = 'B5';
        vaecpSelect.dispatchEvent(new Event('change'));

        carregarVAMO();
        carregarVASCP();
    }

    document.getElementById('VAECP')?.addEventListener('change', carregarVASCP);

    async function carregarVASCP() {
        const valn = document.getElementById('VALN')?.value;
        const vapt = document.getElementById('VAPT')?.value;
        const vacm = document.getElementById('VACM')?.value;
        const vamo = document.getElementById('VAMO')?.value;

        const grupoVASCP = document.getElementById('GrupoVASCP');
        const vaecpSelect = document.getElementById('VAECP');
        const subgrupoVAECP = document.querySelector('#GrupoVAECP .subgrupo');
        const vascpSelect = document.getElementById('VASCP');

        grupoVASCP.style.display = 'block';
        if (subgrupoVAECP) subgrupoVAECP.style.display = 'block';

        const response = await fetch(`/Paginas/Seletores/Configuradores/VA/VASCP.php?VALN=${encodeURIComponent(valn)}&VAPT=${encodeURIComponent(vapt)}&VACM=${encodeURIComponent(vacm)}&VAMO=${encodeURIComponent(vamo)}`);
        const optionsHTML = await response.text();

        vascpSelect.innerHTML = optionsHTML;
        vascpSelect.disabled = false;
        vascpSelect.style.display = 'block';
        vascpSelect.value = '';

        carregarVAMO();
        caregarVAPM();

    }

    document.getElementById('VASCP')?.addEventListener('change', caregarVAPM);

    function caregarVAPM() {
        const vaecp = document.getElementById('VAECP')?.value;
        const grupoVAPM = document.getElementById('GrupoVAPM');
        const vapmSelect = document.getElementById('VAPM');

        grupoVAPM.style.display = 'block';
        vapmSelect.disabled = false;
        vapmSelect.style.display = 'block';
        vapmSelect.value = 'B3';
    }

    function carregarVAMO() {
        const vamoSelect = document.getElementById('VAMO');
        const grupoVAMO = document.getElementById('GrupoVAMO');

        vamoSelect.innerHTML = '';
        vamoSelect.disabled = false;

        vamoSelect.appendChild(new Option("SIM", "S"));
        vamoSelect.appendChild(new Option("NÃO", "N"));
        vamoSelect.value = "N";

        grupoVAMO.style.display = 'block';
        grupoVAMO.dispatchEvent(new Event('change'));

        carregarMOLN();
    }

    const vamoSelect = document.getElementById('VAMO');
    if (vamoSelect) {
        vamoSelect.addEventListener('change', carregarMOLN);
    }

    async function carregarMOLN() {
        const vamoSelect = document.getElementById('VAMO');
        const vaecp = document.getElementById('VAECP')?.value;
        const vacm = document.getElementById('VACM')?.value;
        const vapt = document.getElementById('VAPT')?.value;
        const grupoMOLN = document.getElementById('GrupoMOLN');
        const molnSelect = document.getElementById('MOLN');
        const subgrupoVAMO = document.querySelector('#GrupoVAMO .subgrupo');

        if (vamoSelect.value === "S") {
            grupoMOLN.style.display = 'block';
            if (subgrupoVAMO) subgrupoVAMO.style.display = 'block';

            const response = await fetch(`/Paginas/Seletores/Configuradores/VA/MOLN.php?VACM=${encodeURIComponent(vacm)}&VAPT=${encodeURIComponent(vapt)}&VAECP=${encodeURIComponent(vaecp)}`);
            const optionsHTML = await response.text();
            molnSelect.innerHTML = optionsHTML;

            molnSelect.style.display = 'block';
            molnSelect.disabled = false;
            molnSelect.dispatchEvent(new Event('change'));
        } else {
            grupoMOLN.style.display = 'none';
            if (subgrupoVAMO) subgrupoVAMO.style.display = 'none';
            molnSelect.style.display = 'none';
        }

        molnSelect.value = '';

        carregarMOTP();
        carregarMOOPC();
    }

    const molnSelect = document.getElementById('MOLN');
    if (molnSelect) {
        molnSelect.addEventListener('change', carregarMOTP);
        molnSelect.addEventListener('change', carregarMOOPC);
    }

    async function carregarMOTP() {
        const moln = document.getElementById('MOLN')?.value;
        const vacm = document.getElementById('VACM')?.value;
        const vaecp = document.getElementById('VAECP')?.value;
        const vapt = document.getElementById('VAPT')?.value;
        const grupoMOTP = document.getElementById('GrupoMOTP');
        const motpSelect = document.getElementById('MOTP');


        const response = await fetch(`/Paginas/Seletores/Configuradores/VA/MOTP.php?MOLN=${encodeURIComponent(moln)}&VACM=${encodeURIComponent(vacm)}&VAECP=${encodeURIComponent(vaecp)}&VAPT=${encodeURIComponent(vapt)}`);
        const optionsHTML = await response.text();
        motpSelect.innerHTML = optionsHTML;

        grupoMOTP.style.display = 'block';
        motpSelect.style.display = 'block';
        motpSelect.disabled = false;

        motpSelect.value = '';

        carregarMOTT();
    }

    const motpSelect = document.getElementById('MOTP');
    if (motpSelect) {
        motpSelect.addEventListener('change', carregarMOTT);
    }

    async function carregarMOTT() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const vacm = document.getElementById('VACM')?.value;
        const vaecp = document.getElementById('VAECP')?.value;
        const vapt = document.getElementById('VAPT')?.value;
        const grupoMOTT = document.getElementById('GrupoMOTT');
        const mottSelect = document.getElementById('MOTT');

        const response = await fetch(`/Paginas/Seletores/Configuradores/VA/MOTT.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&VACM=${encodeURIComponent(vacm)}&VAECP=${encodeURIComponent(vaecp)}&VAPT=${encodeURIComponent(vapt)}`);
        const optionsHTML = await response.text();
        mottSelect.innerHTML = optionsHTML;

        grupoMOTT.style.display = 'block';
        mottSelect.style.display = 'block';
        mottSelect.disabled = false;
        mottSelect.value = '';

        carregarMOFQ();
    }

    const mottSelect = document.getElementById('MOTT');
    if (mottSelect) {
        mottSelect.addEventListener('change', carregarMOFQ);
    }

    async function carregarMOFQ() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const vacm = document.getElementById('VACM')?.value;
        const vaecp = document.getElementById('VAECP')?.value;
        const vapt = document.getElementById('VAPT')?.value;
        const grupoMOFQ = document.getElementById('GrupoMOFQ');
        const mofqSelect = document.getElementById('MOFQ');

        const response = await fetch(`/Paginas/Seletores/Configuradores/VA/MOFQ.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}&VACM=${encodeURIComponent(vacm)}&VAECP=${encodeURIComponent(vaecp)}&VAPT=${encodeURIComponent(vapt)}`);

        const optionsHTML = await response.text();
        mofqSelect.innerHTML = optionsHTML;

        grupoMOFQ.style.display = 'block';
        mofqSelect.style.display = 'block';
        mofqSelect.disabled = false;
        mofqSelect.value = '';

        carregarMOPT();
    }

    const mofqSelect = document.getElementById('MOFQ');
    if (mofqSelect) {
        mofqSelect.addEventListener('change', carregarMOPT);
    }

    async function carregarMOPT() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const mofq = document.getElementById('MOFQ')?.value;
        const vacm = document.getElementById('VACM')?.value;
        const vaecp = document.getElementById('VAECP')?.value;
        const vapt = document.getElementById('VAPT')?.value;
        const grupoMOPT = document.getElementById('GrupoMOPT');
        const moptSelect = document.getElementById('MOPT');

        const response = await fetch(`/Paginas/Seletores/Configuradores/VA/MOPT.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}&MOFQ=${encodeURIComponent(mofq)}&VACM=${encodeURIComponent(vacm)}&VAECP=${encodeURIComponent(vaecp)}&VAPT=${encodeURIComponent(vapt)}`);

        const optionsHTML = await response.text();
        moptSelect.innerHTML = optionsHTML;

        grupoMOPT.style.display = 'block';
        moptSelect.style.display = 'block';
        moptSelect.disabled = false;
        moptSelect.value = '';

        carregarMOPL();
    }

    const moptSelect = document.getElementById('MOPT');
    if (moptSelect) {
        moptSelect.addEventListener('change', carregarMOPL);
    }

    async function carregarMOPL() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const mofq = document.getElementById('MOFQ')?.value;
        const mopt = document.getElementById('MOPT')?.value;
        const vacm = document.getElementById('VACM')?.value;
        const vaecp = document.getElementById('VAECP')?.value;
        const vapt = document.getElementById('VAPT')?.value;
        const grupoMOPL = document.getElementById('GrupoMOPL');
        const moplSelect = document.getElementById('MOPL');

        const response = await fetch(`/Paginas/Seletores/Configuradores/VA/MOPL.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}&MOFQ=${encodeURIComponent(mofq)}&MOPT=${encodeURIComponent(mopt)}&VACM=${encodeURIComponent(vacm)}&VAECP=${encodeURIComponent(vaecp)}&VAPT=${encodeURIComponent(vapt)}`);

        const optionsHTML = await response.text();
        moplSelect.innerHTML = optionsHTML;

        grupoMOPL.style.display = 'block';
        moplSelect.style.display = 'block';
        moplSelect.disabled = false;
        moplSelect.value = '';

        carregarMOCP();
    }

    const moplSelect = document.getElementById('MOPL');
    if (moplSelect) {
        moplSelect.addEventListener('change', carregarMOCP);
    }

    async function carregarMOCP() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mott = document.getElementById('MOTT')?.value;
        const mofq = document.getElementById('MOFQ')?.value;
        const mopt = document.getElementById('MOPT')?.value;
        const mopl = document.getElementById('MOPL')?.value;
        const vacm = document.getElementById('VACM')?.value;
        const vaecp = document.getElementById('VAECP')?.value;
        const vapt = document.getElementById('VAPT')?.value;
        const grupoMOCP = document.getElementById('GrupoMOCP');
        const mocpSelect = document.getElementById('MOCP');

        const response = await fetch(`/Paginas/Seletores/Configuradores/VA/MOCP.php?MOLN=${encodeURIComponent(moln)}&MOTP=${encodeURIComponent(motp)}&MOTT=${encodeURIComponent(mott)}&MOFQ=${encodeURIComponent(mofq)}&MOPT=${encodeURIComponent(mopt)}&MOPL=${encodeURIComponent(mopl)}&VACM=${encodeURIComponent(vacm)}&VAECP=${encodeURIComponent(vaecp)}&VAPT=${encodeURIComponent(vapt)}`);

        const optionsHTML = await response.text();
        mocpSelect.innerHTML = optionsHTML;

        grupoMOCP.style.display = 'block';
        mocpSelect.style.display = 'block';
        mocpSelect.disabled = false;
        mocpSelect.value = vaecp;
        mocpSelect.dispatchEvent(new Event('change'));

        carregarMOCPP();
        carregarMOPC();
    }

    function carregarMOCPP() {
        const moln = document.getElementById('MOLN')?.value;
        const mocp = document.getElementById('MOCP')?.value;
        const vacm = document.getElementById('VACM')?.value;
        const grupoMOCPP = document.getElementById('GrupoMOCPP');
        const divSubgrupo = document.querySelector('.SubgrupoMOCP');
        const mocppSelect = document.getElementById('MOCPP');

        const deveExibir = moln !== "3.W" && ["B3", "B34", "B35"].includes(mocp);

        if (deveExibir) {
            mocppSelect.innerHTML = '';
            mocppSelect.innerHTML += '<option value="T" selected>Topo</option>';

            const bloqueado = moln === "2.I" && vacm === "56";
            if (!bloqueado) {
                mocppSelect.innerHTML += '<option value="D">Direita</option>';
                mocppSelect.innerHTML += '<option value="E">Esquerda</option>';
            }

            divSubgrupo.style.display = 'block';
            grupoMOCPP.style.display = 'block';
        } else {
            divSubgrupo.style.display = 'none';
            grupoMOCPP.style.display = 'none';
        }
        carregarMOPC();
    }

    const mocpSelect = document.getElementById('MOCP');
    if (mocpSelect) {
        mocpSelect.addEventListener('change', carregarMOCPP);
        mocpSelect.addEventListener('change', carregarMOPC);
    }

    function carregarMOPC() {
        const moln = document.getElementById('MOLN')?.value;
        const grupoMOPC = document.getElementById('GrupoMOPC');
        const mopcSelect = document.getElementById('MOPC');

        mopcSelect.innerHTML = '';

        const isAPM = moln === "3.APM" || moln === "3.SPM";

        const rotulos = {
            "CX270": "270°",
            "CX180": "180°",
            "CX90": "90°",
            "CX0": "0°",
            "B3": "B3",
            "B6": "B6",
            "B7": "B7",
            "B8": "B8",
            "V5": "V5",
            "V6": "V6"
        };

        const opcoes = isAPM
            ? ["B3", "B6", "B7", "B8", "V5", "V6"]
            : ["CX270", "CX180", "CX90", "CX0"];

        const valorPadrao = isAPM ? "B3" : "CX270";

        opcoes.forEach(valor => {
            const selected = valor === valorPadrao ? 'selected' : '';
            mopcSelect.innerHTML += `<option value="${valor}" ${selected}>${rotulos[valor]}</option>`;
        });

        grupoMOPC.style.display = 'block';
        mopcSelect.disabled = false;

        carregarMOPP();
    }

    const mopcSelect = document.getElementById('MOPC');
    if (mopcSelect) {
        mopcSelect.addEventListener('change', carregarMOPP);
    }

    function carregarMOPP() {
        const moln = document.getElementById('MOLN')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const mocp = document.getElementById('MOCP')?.value;
        const grupoMOPP = document.getElementById('GrupoMOPP');
        const moppSelect = document.getElementById('MOPP');

        if (moln === "3.APM" || moln === "3.SPM") {
            grupoMOPP.style.display = 'none';
            return;
        }

        moppSelect.innerHTML = '';

        const opcoes = [
            { valor: "PC1", label: "1" },
            { valor: "PC2", label: "2" },
            { valor: "PC3", label: "3" },
            { valor: "PC4", label: "4" }
        ];

        opcoes.forEach(op => {
            const option = document.createElement('option');
            option.value = op.valor;
            option.textContent = op.label;
            moppSelect.appendChild(option);
        });

        let valorPadrao = "PC1";
        if (moln === "3.I" || (moln === "2.I" && motp === "T")) valorPadrao = "PC1";
        else if (moln === "2.I" && motp === "M") valorPadrao = "PC2";
        else if (moln === "3.W") valorPadrao = "PC3";

        moppSelect.value = valorPadrao;

        grupoMOPP.style.display = 'block';
        moppSelect.disabled = false;

        carregarMOOPC();
    }

    const moppSelect = document.getElementById('MOPP');
    if (moppSelect) {
        moppSelect.addEventListener('change', carregarMOOPC);
    }

    function carregarMOOPC() {
        const moln = document.getElementById('MOLN')?.value.trim();
        const vacm = document.getElementById('VACM')?.value;
        const motp = document.getElementById('MOTP')?.value;
        const grupoMOPP = document.getElementById('GrupoMOPP');
        const grupoMOOPC = document.getElementById('GrupoMOOPC');
        const checklist = document.querySelectorAll('#checklistMOOPC input[type="checkbox"]');

        if (!grupoMOPP || grupoMOPP.style.display !== 'block' || !grupoMOOPC) {
            grupoMOOPC.style.display = 'none';
            return;
        }

        grupoMOOPC.style.display = 'block';

        checklist.forEach(cb => {
            const value = cb.value;
            let mostrar = true;

            if (["ACOR", "PINTCZ"].includes(value) && (moln === "3.APM" || moln === "3.SPM")) {
                mostrar = false;
            }

            if (value === "VF") {
                mostrar = (moln === "2.I" && ["63", "71"].includes(vacm)) ||
                    (moln === "3.I" && motp !== "F" && ["63", "71", "80", "90", "100-112", "132"].includes(vacm));
            }

            if (value === "CR") {
                mostrar = (moln === "3.W" && ["80", "90", "100-112", "132"].includes(vacm)) ||
                    (moln === "3.I" && ["80", "90", "100-112"].includes(vacm));
            }

            cb.closest('label').style.display = mostrar ? 'block' : 'none';
            if (!mostrar) cb.checked = false;
        });

        validarMOOPC();
        carregarMOCR();
    }

    const moopcSelect = document.getElementById('MOOPC');
    if (moopcSelect) {
        moopcSelect.addEventListener('change', carregarMOCR);
        moopcSelect.addEventListener('change', validarMOOPC);
    }

    function validarMOOPC() {
        const checkboxes = document.querySelectorAll('#checklistMOOPC input[type="checkbox"]');
        let selecionados = Array.from(checkboxes)
            .filter(cb => cb.checked)
            .map(cb => cb.value);

        if (selecionados.includes("NÃO") && selecionados.length > 1) {
            document.querySelector('input[name="MOOPC"][value="NÃO"]').checked = false;
            selecionados = selecionados.filter(v => v !== "NÃO");
        }

        if (selecionados.length === 0) {
            document.querySelector('input[name="MOOPC"][value="NÃO"]').checked = true;
            selecionados = ["NÃO"];
        }

        if (selecionados.includes("ACOR") && selecionados.includes("PINTCZ")) {
            document.querySelector('input[name="MOOPC"][value="ACOR"]').checked = false;
            selecionados = selecionados.filter(v => v !== "ACOR");
        }

        document.getElementById('MOOPC').value = selecionados.join(',');

        const nomesVisiveis = selecionados.map(valor => {
            const label = Array.from(document.querySelectorAll('#checklistMOOPC label')).find(lbl =>
                lbl.querySelector(`input[value="${valor}"]`)
            );
            return label ? label.textContent.trim() : valor;
        });

        document.querySelector('#dropdownMOOPC .dropdown-button').textContent = nomesVisiveis.join(', ');

        carregarMOCR();
    }

    document.getElementById('MOOPC').dispatchEvent(new Event('change'));

    document.addEventListener('DOMContentLoaded', () => {
        const checkboxes = document.querySelectorAll('#checklistMOOPC input[type="checkbox"]');
        checkboxes.forEach(cb => {
            cb.addEventListener('change', validarMOOPC);
        });
    });

    function carregarMOCR() {
        const grupoMOCR = document.getElementById('GrupoMOCR');
        const grupoVACR = document.getElementById('GrupoVACR');
        const subgrupoMOOPC = document.querySelector('.SubgrupoMOOPC');
        const mocrSelect = document.getElementById('MOCR');
        const moopc = document.getElementById('MOOPC')?.value || '';

        const crSelecionado = moopc.split(',').includes('CR');

        if (!crSelecionado) {
            subgrupoMOOPC.style.display = 'none';
            grupoMOCR.style.display = 'none';
            grupoVACR.style.display = 'none';
            mocrSelect.value = '';
            return;
        }

        subgrupoMOOPC.style.display = 'block';
        grupoMOCR.style.display = 'block';
        grupoVACR.style.display = 'none';

        mocrSelect.innerHTML = `
    <option value="H">HORÁRIO</option>
    <option value="AH">ANTI-HORÁRIO</option>
  `;
        mocrSelect.value = '';

        carregarVACR();
    }

    const mocrSelect = document.getElementById('MOCR');
    if (mocrSelect) {
        mocrSelect.addEventListener('change', carregarVACR);
    }

    function carregarVACR() {
        const mocrSelect = document.getElementById('MOCR');
        const grupoVACR = document.getElementById('GrupoVACR');
        const vacrSelect = document.getElementById('VACR');

        const valorMOCR = mocrSelect.value;

        if (!valorMOCR) {
            grupoVACR.style.display = 'none';
            return;
        }

        const valorVACR = valorMOCR === 'H' ? 'H' : 'H';
        const textoVACR = valorVACR === 'H' ? 'HORÁRIO' : 'HORÁRIO';

        vacrSelect.innerHTML = `<option value="${valorVACR}">${textoVACR}</option>`;
        grupoVACR.style.display = 'block';
    }

    function toggleDropdown(botao) {
        const dropdownList = botao.nextElementSibling;
        const isOpen = dropdownList.style.display === 'block';
        dropdownList.style.display = isOpen ? 'none' : 'block';
    }

</script>

<script>
    function exibirBotaoCompartilhar() {
        const wrapper = document.getElementById("compartilhar-wrapper");
        if (wrapper) wrapper.style.display = "block";
        if (typeof exibirBotaoRefazerConfiguracao === "function") exibirBotaoRefazerConfiguracao();
    }

    function exibirBotaoSolicitarDesenho() {
        document.getElementById("solicitar-wrapper").style.display = "inline-flex";
    }

    function exibirBotaoSolicitarCotacao() {
        const wrapper = document.getElementById("cotacao-wrapper");
        if (wrapper) wrapper.style.display = "block";
    }

    async function gerarCodigoProduto() {
        const FORMACONSTRUTIVAVARIADOR = v("VAMO") === "N" ? `.${v("VACM")}${v("VAECP")}` : "";

        const PESMOTOR = v("VAMO") === "S" &&
            v("MOLN") !== "3.W" &&
            ["B3", "B34", "B35"].includes(v("MOCP")) ? v("MOCPP") : "";

        const CARCACA100112 = v("VAMO") === "S" && v("VACM") === "100-112"
            ? await get("CARCACA100112.php", {
                MOLN: v("MOLN"),
                MOTP: v("MOTP"),
                MOTT: v("MOTT"),
                MOFQ: v("MOFQ"),
                MOPT: v("MOPT"),
                MOPL: v("MOPL")
            })
            : v("VACM");

        const CARCACAINICIO = v("VAMO") === "S"
            ? await get("CARCACAINICIO.php", {
                MOLN: v("MOLN"),
                MOTP: v("MOTP"),
                MOTT: v("MOTT"),
                MOFQ: v("MOFQ"),
                MOPT: v("MOPT"),
                MOPL: v("MOPL"),
                MOCM: CARCACA100112
            })
            : "";

        const CARCACAFIM = v("VAMO") === "S"
            ? await get("CARCACAFIM.php", {
                MOLN: v("MOLN"),
                MOTP: v("MOTP"),
                MOTT: v("MOTT"),
                MOFQ: v("MOFQ"),
                MOPT: v("MOPT"),
                MOPL: v("MOPL"),
                MOCM: CARCACA100112
            })
            : "";

        const FORMACONSTRUTIVAMOTOVARIADOR = v("VAMO") === "S"
            ? [CARCACAINICIO, CARCACA100112, CARCACAFIM, v("MOCP"), PESMOTOR, "."].filter(Boolean).join("")
            : "";

        const TEMOPCIONAIS = v("VAMO") === "S" && v("MOOPC") !== "NÃO" && !vazio(v("MOOPC"))
            ? `.${v("MOOPC")}` : "";

        const VARIOSOPCIONAIS = contem(TEMOPCIONAIS, ",")
            ? substituir(TEMOPCIONAIS, ", ", ".")
            : TEMOPCIONAIS;

        const OPCIONAISPADRAO = contem(VARIOSOPCIONAIS, "CR")
            ? `${VARIOSOPCIONAIS}${v("MOCR")}`
            : VARIOSOPCIONAIS;

        const CAIXADELIGACAO = v("VAMO") === "S" && v("MOPC") !== "CX270"
            ? `.${v("MOPC")}` : "";

        const PRENSACABO = v("VAMO") === "S" &&
            !(
                ["3.APM", "3.SPM"].includes(v("MOLN")) ||
                (v("MOLN") === "3.I" && v("MOPP") === "PC1") ||
                (v("MOLN") === "2.I" && v("MOTP") === "T" && v("MOPP") === "PC1") ||
                (v("MOLN") === "2.I" && v("MOTP") === "M" && v("MOPP") === "PC2") ||
                (v("MOLN") === "3.W" && v("MOPP") === "PC3") ||
                vazio(v("MOPP"))
            ) ? `.${v("MOPP")}` : "";

        const CODIGOMOTOR = v("VAMO") === "S"
            ? [
                ".", v("MOLN"),
                ".", v("MOTP"),
                ".", v("MOTT"),
                ".", v("MOPT"),
                ".", v("MOPL"),
                ".", FORMACONSTRUTIVAMOTOVARIADOR,
                v("MOFQ"),
                OPCIONAISPADRAO,
                CAIXADELIGACAO,
                PRENSACABO
            ].filter(Boolean).join("")
            : "";

        const LINHAPRODUTO = seAlgum(
            v("VAMO") === "N", v("VALN"),
            v("VAMO") === "S", substituir(v("VALN"), "1.", "MV.")
        );

        const COMPOSICAOCODIGO = [
            LINHAPRODUTO,
            ".", v("VAPT"),
            FORMACONSTRUTIVAVARIADOR,
            ".", v("VASCP"),
            ".", v("VAPM"),
            CODIGOMOTOR
        ]
            .map(s => s.replace(/^\.|\.$/g, ""))
            .map(s => s.replace(/,\s*/g, ".").replace(/\s+/g, ""))
            .map(s => s.replace(/\.{2,}/g, "."))
            .filter(Boolean)
            .join(".");

        document.getElementById("refProduto").textContent = COMPOSICAOCODIGO;
        mostrarDetalhesProduto({}, COMPOSICAOCODIGO);

        fetch("/Paginas/Seletores/Produto/CodigoDescricaoObservacaoProduto.php", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `codigo=${encodeURIComponent(COMPOSICAOCODIGO)}`
        })
            .then(resp => resp.text())
            .then(text => {
                let dados;
                try { dados = JSON.parse(text); } catch { throw new Error(text); }
                return dados;
            })
            .then(dados => {
                mostrarDetalhesProduto(dados || {}, COMPOSICAOCODIGO);
                if (typeof mostrarDetalhesEstoque === 'function') {
                    mostrarDetalhesEstoque(dados?.CD_PRODUTO || "");
                }
            })
            .catch(err => {
                console.error('Erro ao obter dados do produto', err);
                if (typeof exibirAlerta === 'function') {
                    exibirAlerta('⚠️ Erro ao obter dados do produto.');
                }
                mostrarDetalhesProduto({}, COMPOSICAOCODIGO);
                if (typeof mostrarDetalhesEstoque === 'function') {
                    mostrarDetalhesEstoque('');
                }
            });


        if (window.ultimoHistoricoProduto !== COMPOSICAOCODIGO) {
            fetch("/Paginas/AreaCliente/Sessao/Produtos/RegistrarProduto.php", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `produto=${encodeURIComponent(COMPOSICAOCODIGO)}`
            });
            window.ultimoHistoricoProduto = COMPOSICAOCODIGO;
        }
        exibirBotaoCompartilhar();
        exibirBotaoSolicitarDesenho();
        exibirBotaoSolicitarCotacao();
    }
</script>

<script>
    document.addEventListener('click', e => {
        const img = e.target.closest('.popover img');
        if (!img) return;
        e.preventDefault();
        const container = img.closest('.popover-body');
        if (!container) return;
        const imgs = Array.from(container.querySelectorAll('img')).filter(i => i.naturalWidth);
        const index = imgs.indexOf(img);
        const items = imgs.map(i => ({
            src: i.src,
            width: i.naturalWidth || 800,
            height: i.naturalHeight || 600
        }));
        const lb = new PhotoSwipeLightbox({
            dataSource: items,
            pswpModule: PhotoSwipe,
            initialZoomLevel: 1,
            secondaryZoomLevel: 2,
            wheelToZoom: true,
            imageClickAction: 'zoom'
        });
        lb.on('close', () => lb.destroy());
        lb.init();
        lb.loadAndOpen(index);
    });
</script>

</body>

</html>